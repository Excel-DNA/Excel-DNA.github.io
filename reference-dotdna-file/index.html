<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Excel-DNA Reference: .dna file | Excel-DNA</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://excel-dna.github.io/reference-dotdna-file"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Excel-DNA Reference: .dna file | Excel-DNA"><meta data-rh="true" name="description" content=".dna file schema"><meta data-rh="true" property="og:description" content=".dna file schema"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://excel-dna.github.io/reference-dotdna-file"><link data-rh="true" rel="alternate" href="https://excel-dna.github.io/reference-dotdna-file" hreflang="en"><link data-rh="true" rel="alternate" href="https://excel-dna.github.io/reference-dotdna-file" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Excel-DNA RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Excel-DNA Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X2RC1DGT94"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-X2RC1DGT94",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.cc0f1a7a.css">
<link rel="preload" href="/assets/js/runtime~main.d0f21578.js" as="script">
<link rel="preload" href="/assets/js/main.610cb697.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Excel-DNA" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_dark.svg" alt="Excel-DNA" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Excel-DNA</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://groups.google.com/g/exceldna" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="header-github-link"></a></div><div class="navbar__item"><a href="https://groups.google.com/g/exceldna" target="_blank" rel="noopener noreferrer" class="header-googlegroup-link"></a></div><div class="navbar__item"><a href="https://www.youtube.com/user/govertvd" target="_blank" rel="noreferrer noopener" class="header-youtube-link"></a></div><div class="navbar__item"><a href="https://github.com/sponsors/Excel-DNA" target="_blank" rel="noopener noreferrer" class="header-sponsor-link"><svg class="sponsor-heart-icon" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" d="M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.75.75 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5zM8 14.25l-.345.666-.002-.001-.006-.003-.018-.01a7.643 7.643 0 01-.31-.17 22.075 22.075 0 01-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.08 22.08 0 01-3.744 2.584l-.018.01-.006.003h-.002L8 14.25zm0 0l.345.666a.752.752 0 01-.69 0L8 14.25z"></path></svg><span>&nbsp;&nbsp;Sponsor</span></a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dna-file-schema">.dna file schema<a href="#dna-file-schema" class="hash-link" aria-label="Direct link to .dna file schema" title="Direct link to .dna file schema">​</a></h2><p>Elements and attributes are below.   See *.dna files in downloaded samples.</p><ul><li><p><code>DnaLibrary</code></p><ul><li><code>Name</code></li><li><code>Description</code></li><li><code>Language</code></li><li><code>RuntimeVersion</code> either <code>v4.0</code> for .NET 4, or <code>v2.0</code> (default) for <em>all</em> earlier versions.  i.e. use <code>v2.0</code> for .Net 3.5.  Note that <code>v4.0</code> is required for 64bit Office.</li><li><code>CompilerVersion</code></li><li><code>ShadowCopyFiles=&quot;true&quot;</code> enables shadow copying for the add-in&#x27;s AppDomain.</li></ul></li><li><p><code>ExternalLibrary</code></p><ul><li><code>Path</code></li><li><code>Pack</code></li><li><code>LoadFromBytes</code>.  if =&quot;true&quot; then the .dll is loaded more dynamically which can avoid needing to shut down Excel during debugging. However, it can cause issues with multiple active instances and harder debugging.</li><li><code>ExplicitExports=&quot;true&quot;</code> Prevents every static public function from becomming a UDF, they will need an explicit <code>[ExcelFunction]</code> annotation.</li></ul></li><li><p><code>Project</code></p><ul><li><code>SourceItem</code></li></ul></li><li><p><code>Image</code></p></li><li><p><code>CustomUI</code> Nest <code>&lt;customUI</code> under this to define ribbon.</p></li></ul><p>(Attributes set on the <code>DnaLibrary</code> apply to the implicit project and are not inherited by any <code>&lt;Project&gt;</code> sections.)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="packing">Packing<a href="#packing" class="hash-link" aria-label="Direct link to Packing" title="Direct link to Packing">​</a></h2><p><code>ExcelDnaPack</code> can pack the .dna files and dependent assemblies into a single .xll file.</p><p>The <code>Samples\Packing</code> directory has a number of samples of how to use the packing feature.</p><p>To run the samples, run PackAll.bat - the packed libraries are placed into the out directory.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="default-references-and-imports">Default references and imports<a href="#default-references-and-imports" class="hash-link" aria-label="Direct link to Default references and imports" title="Direct link to Default references and imports">​</a></h2><p>A reference to the ExcelDna.Integration assembly in the .xll file that is
loading a .dna file is always added when the .dna file is compiled.</p><p>In addition, the following references are added to each project, unless a <code>DefaultReferences=&quot;false&quot;</code> attribute is set on the &lt;Project<!-- -->&gt;<!-- -->:</p><ul><li><code>System.dll</code></li><li><code>System.Data.dll</code></li><li><code>System.Xml.dll</code></li></ul><p>For RuntimeVersion=&quot;v4.0&quot; the following are added too:</p><ul><li><code>System.Core.dll</code></li><li><code>System.Data.DataExtensions.dll</code></li><li><code>System.Xml.Linq.dll</code></li><li><code>Microsoft.CSharp.dll</code> (C# projects only)</li></ul><p>For VB projects, the following imports are added, unless a <code>DefaultImports=&quot;false&quot;</code> attribute is set on the <code>&lt;Project&gt;</code>:</p><ul><li><code>Microsoft.VisualBasic</code></li><li><code>System</code></li><li><code>System.Collections</code></li><li><code>System.Collections.Generic</code></li><li><code>System.Data</code></li><li><code>System.Diagnostics</code></li><li><code>ExcelDna.Integration</code></li></ul><p>For <code>RuntimeVersion=&quot;v4.0&quot;</code> the following are added too:</p><ul><li><code>System.Linq</code></li><li><code>System.Xml.Linq</code></li></ul><p>?? <code>Microsoft.Office.Core</code> (for Ribbon)??</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="image-resolution">Image Resolution<a href="#image-resolution" class="hash-link" aria-label="Direct link to Image Resolution" title="Direct link to Image Resolution">​</a></h2><p>Image is only used if the Path is supplied.</p><p>Image Name must match (case sensitive) the image tag in the Ribbon markup.</p><ol><li>If the Path starts with <code>packed:</code> the image is retrieved from resources.</li><li>If the Path contains .....</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference-resolution">Reference Resolution<a href="#reference-resolution" class="hash-link" aria-label="Direct link to Reference Resolution" title="Direct link to Reference Resolution">​</a></h2><p>The <code>&lt;Reference&gt;</code> element has Path (<code>AssemblyPath</code> is deprecated) and <code>Name</code> attributes.
When compiling at runtime, the references are resolved as follows:</p><ol><li>If Path starts with &quot;packed:&quot; the assembly is retrieved from resources, written to a temp file, and the temp file is added to the compiler&#x27;s references list.</li><li>Else If Path is not null and not empty, the assembly is search relative to the .dna file and the xll directory, and in the framework directory. If found, Path is added to the compiler&#x27;s references list.</li><li>Else the Name is passed to LoadWithPartialName for resolution.</li><li>Otherwise the reference is ignored.</li></ol><p>When packing (Reference elements with the Pack=&quot;true&quot; attribute), the reference is resolved as follows:</p><ol><li>If Path starts with &quot;packed:&quot; the reference is ignored.</li><li>If Path is not null and not empty, the assemlby is looked for according to the Path Resolution rules.</li><li>If no file is found, Assembly.Load is attempted with the Path. If the load succeeeds, the assembly location is used to locate and pack the assembly.</li><li>Otherwise, Assembly.LoadWithPartialName with Name is tried. If the load succeeeds, the assembly location is used to locate and pack the assembly.</li><li>If the assembly is still not located, the reference is ignored for packing.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="path-resolution">Path Resolution<a href="#path-resolution" class="hash-link" aria-label="Direct link to Path Resolution" title="Direct link to Path Resolution">​</a></h2><p>For assemblies and .dna files, the following path resolution is done.
Given a path containing a file name, maybe rooted, maybe wi
th some or no directory info, we attempt to find the file as follows:</p><ol><li>If the file is found at the path, we are done.</li><li>Check the path - if it is rooted replace directory with .dna file&#x27;s directory.</li><li>If the path is not rooted, try the whole path relative to the .dna file location (prepend the .dna file&#x27;s directory).</li><li>Else try 2 or 3 using current AppDomain&#x27;s BaseDirectory.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="explicitexports">ExplicitExports<a href="#explicitexports" class="hash-link" aria-label="Direct link to ExplicitExports" title="Direct link to ExplicitExports">​</a></h2><p>If the <code>ExplicitExports</code> attribute is set to <code>true</code> on a <code>Project</code> or <code>ExternalLibrary</code> node, only functions and methods explicitly marked by an</p><p><code>ExcelFunction</code> or <code>ExcelCommand</code> attribute are exported. Otherwise, all public static methods with compatible signatures are exported.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="autoopenautoclose">AutoOpen/AutoClose<a href="#autoopenautoclose" class="hash-link" aria-label="Direct link to AutoOpen/AutoClose" title="Direct link to AutoOpen/AutoClose">​</a></h2><p>Cleanup is only done when the add-in is removed from the add-in manager.</p><p>When <code>File-&gt;Open</code> is used to reopen the .xll, it is closed and opened, causing the .dna file to be re-read.</p></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dna-file-schema" class="table-of-contents__link toc-highlight">.dna file schema</a></li><li><a href="#packing" class="table-of-contents__link toc-highlight">Packing</a></li><li><a href="#default-references-and-imports" class="table-of-contents__link toc-highlight">Default references and imports</a></li><li><a href="#image-resolution" class="table-of-contents__link toc-highlight">Image Resolution</a></li><li><a href="#reference-resolution" class="table-of-contents__link toc-highlight">Reference Resolution</a></li><li><a href="#path-resolution" class="table-of-contents__link toc-highlight">Path Resolution</a></li><li><a href="#explicitexports" class="table-of-contents__link toc-highlight">ExplicitExports</a></li><li><a href="#autoopenautoclose" class="table-of-contents__link toc-highlight">AutoOpen/AutoClose</a></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/installation">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/guides---basic">Guides - Basic</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/guides---advanced">Guides - Advanced</a></li><li class="footer__item">
                  <a href="https://www.youtube.com/user/govertvd" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                  <img src="/img/youtube.png" alt="YouTube" width="20.42" height="14.4" style="margin-right:5px;">govertvd
                  </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Discussions</div><ul class="footer__items clean-list"><li class="footer__item">
                    <a href="https://groups.google.com/g/exceldna" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                    <img src="/img/google_groups.png" alt="Google Groups" width="16" height="16" style="margin-right:5px;">exceldna
                    </a>
                </li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item">
                    <a href="https://github.com/Excel-DNA" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                    <img src="/img/github.png" alt="GitHub" width="16" height="16" style="margin-right:5px;">excel-dna
                    </a>
                </li><li class="footer__item">
                    <a href="mailto:govert@dnakode.com" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                    <img src="/img/email.png" alt="GitHub" width="16" height="11" style="margin-right:5px;">govert@dnakode.com
                    </a>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 DNA Kode, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d0f21578.js"></script>
<script src="/assets/js/main.610cb697.js"></script>
</body>
</html>