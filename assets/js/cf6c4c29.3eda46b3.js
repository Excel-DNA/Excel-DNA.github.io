"use strict";(self.webpackChunkexcel_dna=self.webpackChunkexcel_dna||[]).push([[6823],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=a,h=m["".concat(l,".").concat(d)]||m[d]||p[d]||r;return n?o.createElement(h,i(i({ref:t},u),{},{components:n})):o.createElement(h,i({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6866:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=n(7462),a=(n(7294),n(3905));const r={sidebar_position:1,title:"Using the Excel COM Automation Interfaces"},i=void 0,s={unversionedId:"guides-basic/excel-programming-interfaces/using-the-excel-com-automation-interfaces",id:"guides-basic/excel-programming-interfaces/using-the-excel-com-automation-interfaces",title:"Using the Excel COM Automation Interfaces",description:"Summary",source:"@site/docs/guides-basic/excel-programming-interfaces/using-the-excel-com-automation-interfaces.md",sourceDirName:"guides-basic/excel-programming-interfaces",slug:"/guides-basic/excel-programming-interfaces/using-the-excel-com-automation-interfaces",permalink:"/docs/guides-basic/excel-programming-interfaces/using-the-excel-com-automation-interfaces",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Using the Excel COM Automation Interfaces"},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/docs/guides-basic/excel-programming-interfaces/introduction"},next:{title:"Excel C API",permalink:"/docs/guides-basic/excel-programming-interfaces/excel-c-api"}},l={},c=[{value:"Summary",id:"summary",level:2},{value:"More info about Office versions and Interop Assemblies",id:"more-info-about-office-versions-and-interop-assemblies",level:2},{value:"COM reference management",id:"com-reference-management",level:2},{value:"Samples",id:"samples",level:2}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"summary"},"Summary"),(0,a.kt)("p",null,"To use the Excel COM object model from your macro or ribbon handler, you need to get hold of the right Application object. Use the ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelDnaUtil.Application")," call for this. If you assign this to a ",(0,a.kt)("inlineCode",{parentName:"p"},"dynamic")," variable (C# 4 only), or an 'Object' variable in VB.NET, then everything is straight-forward (but you have no IntelliSense help)."),(0,a.kt)("p",null,"Otherwise you would reference an interop assembly that defines the COM types to your .NET project. You still get the right Application object from ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelDnaUtil.Application"),", but now cast this to the type ",(0,a.kt)("inlineCode",{parentName:"p"},"Microsoft.Office.Interop.Excel.Application")," and use it from there."),(0,a.kt)("p",null,"The easiest way to reference the Interop assemblies is install ",(0,a.kt)("a",{parentName:"p",href:"https://www.nuget.org/packages/ExcelDna.Interop"},"ExcelDna.Interop")," NuGet package, which provides the Excel 2013 PIA assemblies."),(0,a.kt)("h2",{id:"more-info-about-office-versions-and-interop-assemblies"},"More info about Office versions and Interop Assemblies"),(0,a.kt)("p",null,"Just like VBA code, as long as you stick to the parts of the COM object model that are common across versions, nothing in the COM interop part will be version-specific. This means if you you the Excel 2013 interop assemblies, but use only parts of the COM object model that are also there under Excel 2007, your add-in will work fine under Excel 2007 too. In that sense, the COM stuff is all version-independent. It's exactly the same as with VBA."),(0,a.kt)("p",null,"If you make a VBA add-in under Excel 2010, it will work under Excel 2003 too, as long as the parts of the object model you use are supported in both versions. In exactly the same way an Excel-DNA add-in that includes the NuGet ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelDna.Interop")," package (which gives you the Excel 2010 interop assemblies) will work fine under Excel 2003.  You can reference (and even distribute with your add-in) the interop assembly for Excel 2010, and it will work fine under Excel 2003, for those parts of the object model that are common."),(0,a.kt)("p",null,"The only problem you have regarding versions (both in VBA and making an Excel-DNA add-in), it that you can't see in the IntelliSense which parts of the COM object model are supported in which versions. So like in VBA, you might mistakenly use a method or property that does not exist in the hosting Excel version, and that will cause a runtime error. If this is a concern to you, then you can use the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/netoffice"},"NetOffice")," interop assemblies. They are version-independent, in the sense that they contain the union of all properties and methods from all Excel versions. In addition NetOffice gives you IntelliSense info that indicates under which Excel versions a particular method or property is supported. That's great, but the downside is that you have to distribute the NetOffice assemblies too, and can't just \"Embed Interop Types\" like with the Primary Interop Assemblies."),(0,a.kt)("h2",{id:"com-reference-management"},"COM reference management"),(0,a.kt)("p",null,"In an Excel-DNA add-in, all access to the Excel COM object model should be from the main Excel thread. (A call to ExcelAsyncUtil.QueueAsMacro will allow you to initiate code running in a safe context on the main thread, from any other thread or context.)"),(0,a.kt)("p",null,"When used only from the main thread, no special care is needed to manage the Excel COM object lifetimes. ",(0,a.kt)("strong",{parentName:"p"},"Your Excel-DNA add-in should have no calls to ",(0,a.kt)("inlineCode",{parentName:"strong"},"Marshal.ReleaseComObject")," or ",(0,a.kt)("inlineCode",{parentName:"strong"},"Marshal.FinalReleaseComObject"),".")," You also need not follow any rules related to the 'two-dot' access to COM objects. Code inside an Excel-DNA, running on the main thread, can safely access and use the Excel COM object model exactly like VBA code, with no additional concerns for reference counting."),(0,a.kt)("p",null,"Marshal.ReleaseComObject considered dangerous: ",(0,a.kt)("a",{parentName:"p",href:"https://devblogs.microsoft.com/visualstudio/marshal-releasecomobject-considered-dangerous/"},"https://devblogs.microsoft.com/visualstudio/marshal-releasecomobject-considered-dangerous/")),(0,a.kt)("p",null,"Lifetimes of local variables under Debug vs. Release: ",(0,a.kt)("a",{parentName:"p",href:"http://www.bryancook.net/2008/05/net-garbage-collection-behavior-for.html"},"http://www.bryancook.net/2008/05/net-garbage-collection-behavior-for.html")),(0,a.kt)("h2",{id:"samples"},"Samples"),(0,a.kt)("p",null,"Using the .NET 4 'dynamic' type in C#:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'[ExcelCommand(MenuName="Test", MenuText="Range Set")]\npublic static void RangeSet()\n{\n    dynamic xlApp = ExcelDnaUtil.Application;\n\n    xlApp.Range["F1"].Value = "Testing 1... 2... 3... 4";\n}\n')))}p.isMDXComponent=!0}}]);