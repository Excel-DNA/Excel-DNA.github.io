"use strict";(self.webpackChunkexcel_dna=self.webpackChunkexcel_dna||[]).push([[3099],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var l=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},i=Object.keys(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=l.createContext({}),s=function(e){var t=l.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=s(e.components);return l.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},d=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,f=d["".concat(c,".").concat(m)]||d[m]||u[m]||i;return n?l.createElement(f,r(r({ref:t},p),{},{components:n})):l.createElement(f,r({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=d;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:a,r[1]=o;for(var s=2;s<i;s++)r[s]=n[s];return l.createElement.apply(null,r)}return l.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6729:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var l=n(7462),a=(n(7294),n(3905));const i={},r="Background",o={unversionedId:"archive/wiki/Excel-C-API",id:"archive/wiki/Excel-C-API",title:"Background",description:"The Excel C API was first introduced in Excel '95 and has continuously evolved with new versions of Excel. Excel-DNA uses the C API to integrate with Excel, though Excel-DNA add-in can also use the COM Automation interfaces where needed.",source:"@site/docs/archive/wiki/Excel-C-API.md",sourceDirName:"archive/wiki",slug:"/archive/wiki/Excel-C-API",permalink:"/docs/archive/wiki/Excel-C-API",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Dynamic-Arrays",permalink:"/docs/archive/wiki/Dynamic-Arrays"},next:{title:"Excel-DNA-Compatibility-with-Excel",permalink:"/docs/archive/wiki/Excel-DNA-Compatibility-with-Excel"}},c={},s=[{value:"<code>ExcelReference</code>",id:"excelreference",level:2},{value:"<code>XlCall</code>",id:"xlcall",level:2},{value:"Hint for cleaner C API calls",id:"hint-for-cleaner-c-api-calls",level:4},{value:"XlCall functions",id:"xlcall-functions",level:2},{value:"Auxiliary C API functions",id:"auxiliary-c-api-functions",level:3},{value:"Worksheet functions",id:"worksheet-functions",level:3},{value:"Macro functions and commands",id:"macro-functions-and-commands",level:3},{value:"Known  Limitations",id:"known--limitations",level:2}],p={toc:s};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,l.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"background"},"Background"),(0,a.kt)("p",null,"The Excel C API was first introduced in Excel '95 and has continuously evolved with new versions of Excel. Excel-DNA uses the C API to integrate with Excel, though Excel-DNA add-in can also use the COM Automation interfaces where needed."),(0,a.kt)("p",null,"The Excel C API is documented in the ",(0,a.kt)("a",{parentName:"p",href:"http://msdn.microsoft.com/en-us/library/office/bb687883.aspx"},"Excel XLL Software Development Kit"),". The most coherent reference to using the C API is the book by Stephen Dalton - Financial Applications using Excel Add-in Development in C / C++."),(0,a.kt)("p",null,"Direct access to the C API is provided by Excel-DNA via two classes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ExcelDna.Integration.ExcelReference")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ExcelDna.Integration.XlCall"))),(0,a.kt)("h2",{id:"excelreference"},(0,a.kt)("inlineCode",{parentName:"h2"},"ExcelReference")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelReference")," class is a thin wrapper around the C API sheet reference information, and refers to a region (or multiple regions) on a specific sheet. ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelReference")," has helper methods to get and set the values in the region, but for additional information, specific C API calls must be made."),(0,a.kt)("p",null,"Using C API calls it is possible to get the address of an ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelReference")," - calling ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall.Excel(XlCall.xlfReftext, myReference, true)")," - and from there a COM ",(0,a.kt)("inlineCode",{parentName:"p"},"Range")," object may be constructed."),(0,a.kt)("h2",{id:"xlcall"},(0,a.kt)("inlineCode",{parentName:"h2"},"XlCall")),(0,a.kt)("p",null,"The header file in the Excel SDK that defines the C API is called XLCALL.H, so I've called the matching Excel-DNA class ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall"),". It contains these functions:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"XlCall.Excel")," - Calls the ",(0,a.kt)("inlineCode",{parentName:"li"},"Excel4")," / ",(0,a.kt)("inlineCode",{parentName:"li"},"Excel12")," functions of the C API."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"XlCall.TryExcel")," - Same as ",(0,a.kt)("inlineCode",{parentName:"li"},"XlCall.Excel"),", but returns an exact error result instead of throwing."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"XlCall.RTD")," - Wrapper around ",(0,a.kt)("inlineCode",{parentName:"li"},"XlCall.Excel(XlCall.xlfRtd, ...)")," for the registration-free RTD support.")),(0,a.kt)("p",null,"The first parameter to the ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall.Excel")," / ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall.TryExcel")," methods is a function code that identifies the function or command. These function codes are all available as constants on the ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall")," class. The other parameters are marshalled by Excel-DNA from the .NET types to the corresponding C API types. (The parameter count passed in to the Excel function from C is not required in the Excel-DNA call.) Sheet references are passed to the C API as ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelReference")," objects. Missing values (that are not at the end of the call) should be passed as ",(0,a.kt)("inlineCode",{parentName:"p"},"ExcelMissing.Value"),"."),(0,a.kt)("p",null,"Excel-DNA takes care of all type conversion and memory management for the C API calls."),(0,a.kt)("h4",{id:"hint-for-cleaner-c-api-calls"},"Hint for cleaner C API calls"),(0,a.kt)("p",null,"With C# 6 it's possible to bring the static methods of a class into the top-level scope, simplifying the C API usage.\nSo instead of "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"    var result = XlCall.Excel(XlCall.xlfGetDocument, ...);\n")),(0,a.kt)("p",null,"you can write"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"using static ExcelDna.Integration.XlCall;\n...\n    var result = Excel(xlfGetDocument, ...);\n")),(0,a.kt)("p",null,"Similarly, for add-ins made with VB.NET, the ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall")," class can be imported into a file with a call to\n",(0,a.kt)("inlineCode",{parentName:"p"},"Imports ExcelDna.Integration.XlCall"),". Then the functions can be called without the ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall")," prefix: ",(0,a.kt)("inlineCode",{parentName:"p"},"myResult = Excel(xlfGetCell, 7, myReference)")),(0,a.kt)("h2",{id:"xlcall-functions"},"XlCall functions"),(0,a.kt)("p",null,"There is no single source of documentation for all the ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall")," functions. To piece together the available information, it helps to think of the functions in three classes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Auxiliary C API functions"),(0,a.kt)("li",{parentName:"ul"},"Worksheet functions"),(0,a.kt)("li",{parentName:"ul"},"Macro functions and commands")),(0,a.kt)("h3",{id:"auxiliary-c-api-functions"},"Auxiliary C API functions"),(0,a.kt)("p",null,"These are functions like ",(0,a.kt)("inlineCode",{parentName:"p"},"xlfRegister")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"xlSheetId")," that can only be called from add-ins. These form part of the main Excel SDK and are documented in the ",(0,a.kt)("a",{parentName:"p",href:"http://msdn.microsoft.com/en-us/library/office/bb687870.aspx"},"Excel SDK documentation"),"."),(0,a.kt)("h3",{id:"worksheet-functions"},"Worksheet functions"),(0,a.kt)("p",null,"Most of the ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall.xlf... ")," function codes refer to regular Excel worksheet functions, like ",(0,a.kt)("inlineCode",{parentName:"p"},"xlfSum")," and is documented in the regular Excel help."),(0,a.kt)("h3",{id:"macro-functions-and-commands"},"Macro functions and commands"),(0,a.kt)("p",null,"Some information functions like ",(0,a.kt)("inlineCode",{parentName:"p"},"xlfGet...")," and all the ",(0,a.kt)("inlineCode",{parentName:"p"},"xlc...")," function codes refer to Excel 4.0 macro commands and macro sheet functions. These have no updated documentation, but are described in the Excel 4.0 macro help file. The online versions from Microsoft are not easily available anymore."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Excel 4 Macro Help file: (Unzip for the .chm help file - note that you might need Unblock the file under File -> Properties to tell Windows it's safe.) ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Excel-DNA/ExcelDna/files/3989040/XLMACR8.zip"},"XLMACR8.zip"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The same contents in searchable .pdf format: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Excel-DNA/ExcelDna/files/3989034/Excel.4.Macro.Reference.pdf"},"Excel 4 Macro Reference.pdf")))),(0,a.kt)("p",null,"The help file documents the function in the macro form, but the names and parameters match the usage via the C API. For example, the macro function ",(0,a.kt)("inlineCode",{parentName:"p"},"GET.CELL(type_num, reference)")," is called via the C API as ",(0,a.kt)("inlineCode",{parentName:"p"},"XlCall.Excel(XlCall.xlfGetCell, 7, myExcelReference)")," - where the help file shows that 7 retrieves the number format of a cell. A comprehensive sample of the various ",(0,a.kt)("inlineCode",{parentName:"p"},"GET.XXX")," information functions is available in the Excel-DNA distribution under ",(0,a.kt)("inlineCode",{parentName:"p"},"Distribution\\Samples\\GetInfoAddIn.dna")," accompanied by the sheet ",(0,a.kt)("inlineCode",{parentName:"p"},"GetInfoAddIn.xls"),"."),(0,a.kt)("p",null,"Many of the C API functions have been discussed on the Excel-DNA Google group or elsewhere online, so searching on the ",(0,a.kt)("a",{parentName:"p",href:"https://groups.google.com/forum/#!forum/exceldna"},"Excel-DNA Google Group")," is a good start."),(0,a.kt)("h2",{id:"known--limitations"},"Known  Limitations"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"xlfEvaluate"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"xlfGetFormula"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"xlfRegister")," string length limitations.")))}u.isMDXComponent=!0}}]);