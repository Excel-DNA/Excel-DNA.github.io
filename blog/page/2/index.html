<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Blog | Excel-DNA</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://excel-dna.github.io/blog/page/2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Excel-DNA"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://excel-dna.github.io/blog/page/2"><link data-rh="true" rel="alternate" href="https://excel-dna.github.io/blog/page/2" hreflang="en"><link data-rh="true" rel="alternate" href="https://excel-dna.github.io/blog/page/2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Excel-DNA RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Excel-DNA Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X2RC1DGT94"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-X2RC1DGT94",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.cc0f1a7a.css">
<link rel="preload" href="/assets/js/runtime~main.0d6c618f.js" as="script">
<link rel="preload" href="/assets/js/main.e225714c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Excel-DNA" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_dark.svg" alt="Excel-DNA" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Excel-DNA</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://groups.google.com/g/exceldna" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="header-github-link"></a></div><div class="navbar__item"><a href="https://groups.google.com/g/exceldna" target="_blank" rel="noopener noreferrer" class="header-googlegroup-link"></a></div><div class="navbar__item"><a href="https://www.youtube.com/user/govertvd" target="_blank" rel="noreferrer noopener" class="header-youtube-link"></a></div><div class="navbar__item"><a href="https://github.com/sponsors/Excel-DNA" target="_blank" rel="noopener noreferrer" class="header-sponsor-link"><svg class="sponsor-heart-icon" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" d="M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.75.75 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5zM8 14.25l-.345.666-.002-.001-.006-.003-.018-.01a7.643 7.643 0 01-.31-.17 22.075 22.075 0 01-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.08 22.08 0 01-3.744 2.584l-.018.01-.006.003h-.002L8 14.25zm0 0l.345.666a.752.752 0 01-.69 0L8 14.25z"></path></svg><span>&nbsp;&nbsp;Sponsor</span></a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/07/excel-dna-1.6-.net6-packagereference-anti-virus">Excel-DNA 1.6 – .NET 6 / PackageReference / Anti-virus</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/07/15/update-v1.5-sponsors-roadmap">Update v 1.5 / Sponsors / Roadmap</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/06/29/excel-dna-version-1.1">Excel-DNA version 1.1</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/08/11/getting-started-or-why-are-you-still-using-vba">Getting started (or: Why Are You Still Using VBA?)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/03/17/excel-dna-version-1.0">Excel-DNA version 1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/09/21/develop-excel-conference">Develop Excel Conference – London, 18 October 2018</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/05/31/excel-dna-0-34-final-testing">Excel-DNA version 0.34</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/24/excel-udf-intellisense-for-excel-dna-and-vba">Excel UDF IntelliSense for Excel-DNA and VBA</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/06/10/add-in-spotlight-acq-for-interpolation">Add-in spotlight: ACQ for interpolation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/09/03/excel-dna-version-0-33-8-rc2-available">Excel-DNA version 0.33.8-rc2 available</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/08/03/excel-dna-0-33-release-candidate-and-license-change">Excel-DNA 0.33 Release Candidate and License Change</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/05/04/excel-dna-0-32-released">Excel-DNA 0.32 Released</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling">Excel-DNA 0.32 - Breaking changes to integer and boolean parameter handling</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/03/21/tutorial-com-server-support-for-vba-integration">Tutorial: COM server support for VBA integration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/03/03/excel-dna-0-32-release-candidate">Excel-DNA 0.32 Release Candidate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/11/14/getting-started-with-f-and-excel-dna-in-finance">Getting started with F# and Excel-DNA in finance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/10/07/streaming-real-time-data-to-excel">Streaming real-time data to Excel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/08/05/f-and-r-in-excel">F# and R in Excel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/04/02/caching-and-asynchronous-excel-udfs">Caching and Asynchronous Excel UDFs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/03/26/async-and-event-streaming-excel-udfs-with-f">Async and event-streaming Excel UDFs with F#</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2012/12/20/excel-dna-nuget-package-updated">Excel-DNA NuGet Package Updated</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2012/12/13/excel-dna-version-0-30-released">Excel-DNA Version 0.30 Released</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2012/05/04/patrick-obeirnes-guide-on-excel-vba-to-vb-net-migration">Patrick O&#x27;Beirne&#x27;s guide for Excel VBA to VB.NET migration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2012/01/30/excel-vba-to-vb-net-with-excel-dna-and-netoffice">Excel VBA to VB.NET with Excel-DNA and NetOffice</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2011/05/16/excel-dna-version-0-29-rc-available">Excel-DNA version 0.29 - RC available</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2011/04/28/financial-analytics-suite-finansu-made-with-excel-dna">Financial Analytics Suite (FinAnSu) - made with Excel-DNA</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2011/01/30/resizing-excel-udf-result-arrays">Resizing Excel UDF result arrays</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2010/12/09/cluster-udf-support">Offloading UDF computations to a Windows HPC cluster from Excel 2010</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2015/08/03/excel-dna-0-33-release-candidate-and-license-change">Excel-DNA 0.33 Release Candidate and License Change</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2015-08-03T00:50:00.000Z" itemprop="datePublished">August 3, 2015</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="version-033-release-candidate">Version 0.33 Release Candidate<a href="#version-033-release-candidate" class="hash-link" aria-label="Direct link to Version 0.33 Release Candidate" title="Direct link to Version 0.33 Release Candidate">​</a></h2><p>Excel-DNA 0.33 contains a number of bug fixes and improvements, including a <a href="https://github.com/Excel-DNA/ExcelDna/wiki/Diagnostic-Logging" target="_blank" rel="noopener noreferrer">diagnostic logging</a> approach based on the .NET Trace classes. More details can be found in the current <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/Distribution/ChangeLog.txt" target="_blank" rel="noopener noreferrer">ChangeLog</a>.</p><p>This version will also be the foundation for a first release of the custom Registration extension and the ongoing work towards on-sheet IntelliSense for user-defined functions.</p><p>A release candidate for the new version is available</p><ul><li>as a <a href="https://github.com/Excel-DNA/ExcelDna/releases/tag/v0.33.7-rc1" target="_blank" rel="noopener noreferrer">GitHub release</a>;</li><li>as a <a href="https://exceldna.codeplex.com/releases/view/616591" target="_blank" rel="noopener noreferrer">CodePlex download</a>;</li><li>and in the (pre-release) <a href="https://www.nuget.org/packages/ExcelDna.AddIn/" target="_blank" rel="noopener noreferrer">ExcelDna.AddIn NuGet package</a>.</li></ul><p>Please help me test that the new version works correctly in the many different ways, Excel and Windows versions, and languages where Excel-DNA add-ins run.</p><p>If you run into any unexpected behavior bugs or regressions, please post to the <a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">Google group</a> or contact me directly.</p><p>Also, if you are able to confirm that the new version works in a particular setting, please post that too. Details about what functionality you&#x27;ve tested and what operating environment (including .NET and Excel version) you are running with, would help me a lot.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="license-change">License Change<a href="#license-change" class="hash-link" aria-label="Direct link to License Change" title="Direct link to License Change">​</a></h2><p><del>For the Excel-DNA project, I&#x27;ve changed to the standard <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/LICENSE.txt" target="_blank" rel="noopener noreferrer">MIT license</a>. This has become the most common open-source license aligned with my intention of making Excel-DNA free for all use, including commercial use</del>. <strong>UPDATE 2015-09-03</strong>: Excel-DNA is (again) licensed under the <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/LICENSE.txt" target="_blank" rel="noopener noreferrer">zlib license</a>. More details <a href="/2015/09/03/excel-dna-version-0-33-8-rc2-available/">here</a>.</p><p>If you have any concerns with this change, please let me know.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nuget-packages">NuGet Packages<a href="#nuget-packages" class="hash-link" aria-label="Direct link to NuGet Packages" title="Direct link to NuGet Packages">​</a></h2><p>With this version, I am re-aligning the Excel-DNA package names on NuGet with the assembly names and standard naming conventions. The main packages for this release will be:</p><ul><li><p><strong><a href="https://www.nuget.org/packages/ExcelDna.AddIn/" target="_blank" rel="noopener noreferrer">ExcelDna.AddIn</a></strong> - Includes the <code>.xll</code> and creates a complete add-in when installed into a Class Library project. This is update of the &quot;Excel-DNA&quot; package.</p></li><li><p><strong><a href="https://www.nuget.org/packages/ExcelDna.Integration/" target="_blank" rel="noopener noreferrer">ExcelDna.Integration</a></strong> - Contains only the integration reference library, suitable for referencing in third-party libraries that are intended to be used in Excel-DNA add-ins. An update of the &quot;Excel-DNA.Lib&quot; package.</p></li></ul><p>The old packages will be updated to refer to the new ones as dependencies, which should allow package updates to work correctly.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github">GitHub<a href="#github" class="hash-link" aria-label="Direct link to GitHub" title="Direct link to GitHub">​</a></h2><p>The Excel-DNA project is (slowly) moving to <a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><ul><li>The core library project can be found at <a href="https://github.com/Excel-DNA/ExcelDna/" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/ExcelDna</a>, where the latest source versions are hosted.</li><li>The best documentation and links to related projects and other source is still found on the old <a href="https://exceldna.codeplex.com" target="_blank" rel="noopener noreferrer">CodePlex site</a>.</li><li>For general questions and discussion about Excel-DNA, please continue use the <a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>.</li><li>Specific issues, bug reports and feature requests can be added to the <a href="https://github.com/Excel-DNA/ExcelDna/issues/" target="_blank" rel="noopener noreferrer">GitHub Issues</a> list.</li><li>For a permanent bookmark to the project, please use the Excel-DNA home page at <a href="/">http://excel-dna.net</a>.</li></ul><hr><p>Thank you for your continued support of Excel-DNA!</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2014/05/04/excel-dna-0-32-released">Excel-DNA 0.32 Released</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2014-05-04T15:46:00.000Z" itemprop="datePublished">May 4, 2014</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>I&#x27;ve posted a final release of Excel-DNA version 0.32 to CodePlex (<a href="https://exceldna.codeplex.com/releases/view/119190" target="_blank" rel="noopener noreferrer">https://exceldna.codeplex.com/releases/view/119190</a>) and the NuGet package repository (<a href="https://www.nuget.org/packages/Excel-DNA" target="_blank" rel="noopener noreferrer">https://www.nuget.org/packages/Excel-DNA</a>).</p><p>Excel-DNA 0.32 consolidates a large number of bug fixes and improvements that have accumulated over the last year. In particular, a number of edge cases that affect Excel-DNA add-ins under Excel 2013 have been addressed.</p><p>Native asynchronous functions, available under Excel 2010 and later, are now supported. Runtime registration of delegate functions and external retrieval of registration details will allow development of extension features without requiring changes to the Excel-DNA core runtime - see the ExcelDna.CustomRegistration project for examples of the dynamic registration: <a href="https://github.com/Excel-DNA/CustomRegistration" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/CustomRegistration</a></p><p>Excel-DNA 0.32 introduces one breaking change: integer parameter conversions are modified to be consistent with VBA. Fractional values passed to functions with integer parameters are converted using the round-to-even convention - as is the case for VBA functions. This issue is discussed in more detail at <a href="/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling/">http://excel-dna.net/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling/</a></p><p>See the <a href="https://exceldna.codeplex.com/SourceControl/latest#Distribution/ChangeLog.txt" target="_blank" rel="noopener noreferrer">Distribution\ChangeLog.txt</a> file for a complete list of changes in this version.</p><p>As always, I greatly appreciate any feedback on this version, and on Excel-DNA in general. Any comments or questions are welcome on the Google group or by contacting me directly.</p><p>To ensure future development of Excel-DNA, please make a donation via PayPal or arrange for a corporate support agreement. See <a href="/support/">http://excel-dna.net/support/</a> for details.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling">Excel-DNA 0.32 - Breaking changes to integer and boolean parameter handling</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2014-05-03T07:08:00.000Z" itemprop="datePublished">May 3, 2014</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Excel-DNA version 0.32 introduces some changes in the parameter conversions applied to integer and boolean parameters. These changes improve compatibility with VBA, and make it easier to provide a consistent implementation when the conversion needs to be explicitly implemented, as for some generated methods.</p><p>In Excel-DNA versions before 0.32, UDF functions taking integer and boolean parameters were registered with the C API using the respective types, and hence the conversions were performed by Excel before calling the UDF. In Excel-DNA 0.32, these conversions are performed by Excel-DNA, with the changes discussed here. Affected functions would previously have behaved consistent with <code>.xll</code> add-ins made with C/C++, where registered with integer or boolean parameter types.</p><p>The new behaviour for integer conversions is that double values passed from Excel to integer parameters in UDFs are converted using the &quot;Round-To-Even&quot; midpoint rounding convention. Previously, positive midpoint values (like <code>2.5</code>) were rounded up (to <code>3</code>), while negative midpoint values were rounded down (<code>-2.5</code> to <code>-3</code>), with the exception that <code>-0.5</code> was rounded to <code>0</code>. <code>Int64</code> (<code>long</code>) parameters are now also handled consistently.</p><p>One exception to the VBA compatibility guideline is that incoming boolean <code>true</code> values passed to integer parameters are converted to <code>1</code>, rather than <code>-1</code> as would be the case with VBA. For this case I consider it more important to be consistent with .NET conventions, whereby boolean <code>true</code> values are represented by <code>1</code>.</p><p>For conversions to boolean parameters, the main change is in how fractional values are converted to booleans. The new version is consistent with VBA - any non-zero value is converted to <code>true</code>.</p><p>I hope you will agree that the improved consistency is worth making these breaking changes, and that the decision will not cause any unexpected problems. As always, I appreciate any feedback, either directly or via the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>.</p><hr><p>The following snapshot gives a good summary of the changes:</p><p><img loading="lazy" alt="Param Conversion Table Changes" src="data:image/png;base64,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" width="749" height="263" class="img_ev3q"></p><p>The functions used are as follows:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dnaConvertInt32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-vb codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vb codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Function</span><span class="token plain"> VbaConvertInteger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token keyword" style="color:#00009f">As</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VbaConvertInteger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">End</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Function</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dnaConvertInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dnaConvertBoolean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-vb codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vb codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Function</span><span class="token plain"> VbaConvertBoolean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token keyword" style="color:#00009f">As</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VbaConvertBoolean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">End</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Function</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/0-32">0.32</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/conversions">conversions</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2014/03/21/tutorial-com-server-support-for-vba-integration">Tutorial: COM server support for VBA integration</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2014-03-21T23:16:00.000Z" itemprop="datePublished">March 21, 2014</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Functions and macros created in an Excel-DNA add-in can be called directly from Excel VBA by using <code>Application.Run(...)</code>. However, .NET also supports creating rich object models that are exported as COM libraries, which can be Tools-&gt;Referenced in VBA. Excel-DNA has some advanced support to host COM-exported objects from Excel-DNA add-ins, giving some advantages over the regular .NET &quot;Register for COM interop&quot; hosting approach:</p><ul><li><p>COM objects that are created via the Excel-DNA COM server support will be active in the same AppDomain as the rest of the add-in, allowing direct shared access to static variables, internal caches etc.</p></li><li><p>COM registration for classes hosted by Excel-DNA does not require administrative access (even when registered via <code>RegSvr32.exe</code>).</p></li><li><p>Everything needed for the COM server can be packed in a single-file .xll add-in, including the type library used for IntelliSense support in VBA.</p></li></ul><p><a href="http://mikejuniperhill.blogspot.com/" target="_blank" rel="noopener noreferrer">Mikael Katajamäki</a> has written some detailed tutorial posts on his <a href="http://mikejuniperhill.blogspot.com/" target="_blank" rel="noopener noreferrer">Excel in Finance</a> blog that explore this Excel-DNA feature, with detailed explanation, step-by-step instructions, screen shots and further links. See:</p><ul><li><a href="http://mikejuniperhill.blogspot.com/2014/03/interfacing-c-and-vba-with-exceldna-no.html" target="_blank" rel="noopener noreferrer">Interfacing C# and VBA with Excel-DNA (no intellisense support)</a></li><li><a href="http://mikejuniperhill.blogspot.com/2014/03/interfacing-c-and-vba-with-exceldna_16.html" target="_blank" rel="noopener noreferrer">Interfacing C# and VBA with Excel-DNA (with intellisense support)</a></li></ul><p>Note that these techniques would work equally well with code written in VB.NET, allowing you to port VB/VBA libraries to VB.NET with Excel-DNA and then use these from VBA.</p><p>Thank you Mikael for the great write-up!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/net">.net</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/com">com</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/excel">excel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/excel-vba">excel-vba</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/exceldna">exceldna</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/vba">vba</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/xll">xll</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2014/03/03/excel-dna-0-32-release-candidate">Excel-DNA 0.32 Release Candidate</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2014-03-03T23:16:00.000Z" itemprop="datePublished">March 3, 2014</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>I have posted to CodePlex (<a href="https://exceldna.codeplex.com/releases/view/119190" target="_blank" rel="noopener noreferrer">https://exceldna.codeplex.com/releases/view/119190</a>) and the NuGet package manager (<a href="https://www.nuget.org/packages/Excel-DNA/0.32.0-rc1" target="_blank" rel="noopener noreferrer">https://www.nuget.org/packages/Excel-DNA/0.32.0-rc1</a>) a release candidate of the next Excel-DNA version.</p><p>I hope to make a final release in the next few weeks, once I&#x27;ve had confirmation that this version works well on the various platforms and Excel versions.</p><p>Please test, and let me know of any problems or surprises you run into, or confirm what features, platforms and Excel versions work correctly.</p><p>The CodePlex download is structured as before, and for the NuGet package manager, you can upgrade to the pre-release version with:</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PM&gt; Upgrade-Package Excel-DNA -Pre</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><p><strong>Excel-DNA 0.32</strong> consolidates a large number of bug fixes and improvements that have accumulated over the last year. In particular, a number of edge cases that affect Excel-DNA add-ins under Excel 2013 have been addressed.</p><p>Native asynchronous functions, available under Excel 2010 and later, are now supported. Runtime registration of delegate functions and external retrieval of registration details will allow development of extension features without requiring changes to the Excel-DNA core runtime.</p><p>Excel-DNA 0.32 is compatible with version 0.30, and introduces no notable breaking changes. See the Distribution\ChangeLog.txt file for a complete change list.</p><p>As always, I greatly appreciate any feedback on this version, and on Excel-DNA in general. Any comments or questions are welcome on the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Google group</a> or by contacting me directly.</p><p><em>To ensure future development of Excel-DNA, please make a donation via PayPal or arrange for a corporate support agreement. See <a href="/support/">http://excel-dna.net/support/</a> for details</em>.</p><p>Thank you for your continued support,
Govert</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/exceldna">exceldna</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/nuget">nuget</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2013/11/14/getting-started-with-f-and-excel-dna-in-finance">Getting started with F# and Excel-DNA in finance</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2013-11-14T00:20:00.000Z" itemprop="datePublished">November 14, 2013</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="http://bramjochems.com" target="_blank" rel="noopener noreferrer">Bram Jochems</a> has written a friendly <a href="http://bramjochems.com/blog/2013/10/example-f-exceldna/" target="_blank" rel="noopener noreferrer">&quot;Getting Started&quot; post</a>, discussing how to use F# with Excel-DNA in a finance context. His add-in with various F# / Excel-DNA helper utilities, and a bunch of quantitative finance-related UDFs, including option pricing function and volatility interpolation, has been published as a <a href="https://github.com/bramjochems/MyExcelLib" target="_blank" rel="noopener noreferrer">project on GitHub</a>.</p><p>It&#x27;s well worth a look, whether you are using F# and keen to explore Excel-DNA, or just curious about F# and looking for some practical examples.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/examples">examples</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/excel">excel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rtd">rtd</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rx">rx</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2013/10/07/streaming-real-time-data-to-excel">Streaming real-time data to Excel</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2013-10-07T23:13:00.000Z" itemprop="datePublished">October 7, 2013</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Gert-Jan van der Kamp has posted a very nice end-to-end example on <a href="http://www.codeproject.com/Articles/662009/Streaming-realtime-data-to-Excel" target="_blank" rel="noopener noreferrer">CodeProject</a>, showing how to create a WCF service and Excel-DNA add-in to stream real-time data into Excel.</p><p>The example uses to use the Reactive Extensions support in Excel-DNA v. 0.30 to push the data to an Excel UDF (using Excel&#x27;s RTD mechanism behind the scenes), together with a Duplex WCF service providing the data.</p><p>There was also this <a href="https://exceldna.codeplex.com/discussions/460904" target="_blank" rel="noopener noreferrer">CodePlex discussion</a> about the Excel ThrottleInterval option, which trades off the real-time update frequency against stability of the Excel calculation.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/examples">examples</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/excel">excel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rtd">rtd</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rx">rx</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2013/08/05/f-and-r-in-excel">F# and R in Excel</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2013-08-05T23:38:00.000Z" itemprop="datePublished">August 5, 2013</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Natallie Baikevich has posted some very pretty examples of using F# with Excel-DNA. One function uses the R type provider to easily expose a feature from an R package as an UDF in Excel. Have a look at the <a href="http://luajalla.azurewebsites.net/excel-dna-three-stories/" target="_blank" rel="noopener noreferrer">write-up</a>, and the <a href="https://github.com/luajalla/everything-fun/tree/master/exceldna-sample" target="_blank" rel="noopener noreferrer">code on GitHub</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/samples">samples</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/fsharp">fsharp</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2013/04/02/caching-and-asynchronous-excel-udfs">Caching and Asynchronous Excel UDFs</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2013-04-02T23:32:00.000Z" itemprop="datePublished">April 2, 2013</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>This sample shows how the result of an Excel-DNA async UDF call can be cached using the .NET 4 MemoryCache class.</p><p>PS: Apparently there is a bug in the memory management of the .NET MemoryCache class. See the <a href="http://stackoverflow.com/questions/6895956/memorycache-strangeness" target="_blank" rel="noopener noreferrer">StackOverflow discussion</a> and the <a href="https://connect.microsoft.com/VisualStudio/feedback/details/806334/system-runtime-caching-memorycache-do-not-respect-memory-limits#" target="_blank" rel="noopener noreferrer">Connect bug report</a>. The <a href="http://www.nuget.org/packages/SharpMemoryCache" target="_blank" rel="noopener noreferrer">SharpMemoryCache NuGet package</a> might be an alternative, though I&#x27;ve not tried it.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">DnaLibrary</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">CachedAsyncSample</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">RuntimeVersion</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">v4.0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Language</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">C#</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Reference</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">System.Runtime.Caching</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token cdata" style="color:#999988;font-style:italic">&lt;![CDATA[</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using System.Threading;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using System.Runtime.Caching;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using ExcelDna.Integration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    public static class dnaFunctions</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        public static object dnaCachedAsync(string input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // First check the cache, and return immediately </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // if we found something.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // (We also need a unique key to identify the cache item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            string key = &quot;dnaCachedAsync:&quot; + input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            ObjectCache cache = MemoryCache.Default; </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            string cachedItem = cache[key] as string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            if (cachedItem != null) </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                return cachedItem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Not in the cache - make the async call </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // to retrieve the item. (The second parameter here should identify </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // the function call, so would usually be an array of the input parameters, </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // but here we have the identifying key already.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            object asyncResult = ExcelAsyncUtil.Run(&quot;dnaCachedAsync&quot;, key, () =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // Here we fetch the data from far away....</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // This code will run on a ThreadPool thread.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // To simulate a slow calculation or web service call,</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // Just sleep for a few seconds...</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                Thread.Sleep(5000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // Then return the result</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                return &quot;The calculation with input &quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                        + input + &quot; completed at &quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                        + DateTime.Now.ToString(&quot;HH:mm:ss&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Check the asyncResult to see if we&#x27;re still busy</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            if (asyncResult.Equals(ExcelError.ExcelErrorNA))</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                return &quot;!!! Fetching data&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // OK, we actually got the result this time.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Add to the cache and return</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // (keeping the cached entry valid for 1 minute)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Note that the function won&#x27;t recalc automatically after </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            //    the cache expires. For this we need to go the </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            //    RxExcel route with an IObservable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            cache.Add(key, asyncResult, DateTime.Now.AddMinutes(1), null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            return asyncResult;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        public static string dnaTest()</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            return &quot;Hello from CachedAsyncSample&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="display:inline-block;color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">  ]]&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">DnaLibrary</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/samples">samples</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/async">async</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/csharp">csharp</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cache">cache</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/excel">excel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/udf">udf</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2013/03/26/async-and-event-streaming-excel-udfs-with-f">Async and event-streaming Excel UDFs with F#</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2013-03-26T08:18:00.000Z" itemprop="datePublished">March 26, 2013</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/414659" alt="Govert van Drimmelen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Govert van Drimmelen</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>There have been a some recent posts mentioning the <a href="http://blogs.msdn.com/b/dsyme/archive/2013/03/24/asynchronous-programming-from-f-to-python.aspx" target="_blank" rel="noopener noreferrer">asynchronous</a> and <a href="http://www.infoq.com/interviews/petricek-fsharp-functional-languages" target="_blank" rel="noopener noreferrer">reactive</a> programming features in F#. Since Excel-DNA 0.30 added support for creating async and <code>IObservable</code>-based real-time data functions, I&#x27;d like to show how these F# features can be nicely exposed to Excel via Excel-DNA.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iobservable-to-excel-via-excel-dna">IObservable to Excel via Excel-DNA<a href="#iobservable-to-excel-via-excel-dna" class="hash-link" aria-label="Direct link to IObservable to Excel via Excel-DNA" title="Direct link to IObservable to Excel via Excel-DNA">​</a></h2><p>Excel-DNA 0.30 allows an add-in to expose <code>IObservable</code> sources to Excel as real-time data functions. (Actually Excel-DNA defines an interface called <code>IExcelObservable</code> that matches the semantics of `IObservable&lt;\object&gt; - this is because we still target .NET 2.0 with the core library.)</p><p>Asynchronous function can then be implemented as an <code>IObservable</code> that returns a single value before completing. Cancellation (triggered when the user removes a real-time or async formula) is supported via the standard IDisposable mechanism.</p><p>Internally, Excel-DNA implements a thread-safe RTD server and registers the <code>IObservable</code> as an RTD topic. So some aspects of the <code>IObservable</code> support are subject to Excel&#x27;s RTD feature works, for example the RTD throttle interval (by default 2 seconds) will also apply to <code>IObservable</code> functions.</p><p>The following functions in the <code>ExcelDna.Integration.ExcelAsyncUtil</code> helper class are relevant:</p><ul><li><p><code>ExcelAsyncUtil.Initialize()</code> - this should be called in a macro context before any of the other features are used, typically from the <code>AutoOpen()</code> handler.</p></li><li><p><code>ExcelAsyncUtil.Observe(...)</code> - registers an IExcelObservable as a real-time data function with Excel. <code>Subsequent OnNext()</code> calls will raise updates via RTD.</p></li><li><p><code>ExcelAsyncUtil.Run(...)</code> - a helper method that runs a function asynchronously on a .NET threadpool thread.</p></li></ul><p>In addition, we&#x27;ll use</p><ul><li><code>ExcelObservableSource</code> - a delegate type for functions that return an <code>IExcelObservable</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="some-links">Some links:<a href="#some-links" class="hash-link" aria-label="Direct link to Some links:" title="Direct link to Some links:">​</a></h3><ul><li><a href="http://exceldna.codeplex.com/wikipage?title=Asynchronous%20Functions" target="_blank" rel="noopener noreferrer">Async functions in C#</a> - has some sample functions in C#.</li><li><a href="http://exceldna.codeplex.com/wikipage?title=Reactive%20Extensions%20for%20Excel" target="_blank" rel="noopener noreferrer">Reactive Extensions for Excel (RxExcel)</a> - the RxExcel class is a small wrapper that bridges the <code>IExcelObservable</code> to any implementation of <code>IObservable&lt;T&gt;</code>, allowing the Rx libraries to be used in Excel.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="f-helpers-for-async-and-iobservable-based-events">F# helpers for async and IObservable-based events<a href="#f-helpers-for-async-and-iobservable-based-events" class="hash-link" aria-label="Direct link to F# helpers for async and IObservable-based events" title="Direct link to F# helpers for async and IObservable-based events">​</a></h2><p>To initialize the async support in Excel-DNA, we need some code like the following:</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> FsAsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> Microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FSharp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Control</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WebExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> ExcelDna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Integration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// This class implements the IExcelAddin which allows us to initialize the ExcelAsyncUtil support.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// It must not be a nested class (e.g. defined as a type inside a module) but a top-level class (inside a namespace)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">FsAsyncAddIn</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">IExcelAddIn</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoOpen </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Initialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoClose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Uninitialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// define a regular Excel UDF just to show that the add-in works</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">[&lt;</span><span class="token annotation class-name">ExcelFunction</span><span class="token annotation annotation-content punctuation" style="color:#393A34">(</span><span class="token annotation annotation-content">Description</span><span class="token annotation annotation-content operator" style="color:#393A34">=</span><span class="token annotation annotation-content string" style="color:#e3116c">&quot;A test function from F#&quot;</span><span class="token annotation annotation-content punctuation" style="color:#393A34">)</span><span class="token annotation punctuation" style="color:#393A34">&gt;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> fsaAddThem </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>F# supports an asynchronous programming model via &quot;async computation expressions&quot;. The result of an async computation expression is a value of type <code>Async&lt;T&gt;</code>, which we need to convert to an <code>IExcelObservable</code>. We use a standard <code>CancellationTokenSource</code> hooked up to the <code>IDisposable</code> to enable cancellation.</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> FsAsyncUtil </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# Async computation to Excel-DNA </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelRunAsync functionName parameters async </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// make something like CancellationDisposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> cts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CancellationTokenSource</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> disp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IDisposable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Dispose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cancel </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Start the async computation on this thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StartWithContinuations </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">   async</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">OnNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnError ex </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Token </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// return the disposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        disp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another neat feature of F# is that events are first-class types that implement <code>IObservable</code>. This means any F# event can serve as a real-time data source in an Excel formula. To bridge the F# events to the <code>IExcelObservable</code> interface is really easy, we just have the following helper:</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# IObservable to Excel-DNA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelObserve functionName parameters observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// Subscribe to the F# observable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnNext </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> observable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample-functions">Sample functions<a href="#sample-functions" class="hash-link" aria-label="Direct link to Sample functions" title="Direct link to Sample functions">​</a></h2><p>Given the above helpers, we can now explore a few ways to implement async and real-time streaming functions. As examples:</p><p>Here is a plain synchronous function to download a url into a string:</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;!!!ERROR: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Async implementation 1</strong>: Use Excel-DNA async directly to run <code>downloadString</code> on a <code>ThreadPool</code> thread</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncRunTP1 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;downloadStringAsyncTP1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create an F# asynchronous computation for the download (this functions is not exported to Excel)</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncImpl url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token computation-expression keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// In here we could check for cancellation using </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// let! ct = Async.CancellationToken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// if ct.IsCancellationRequested then ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let!</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AsyncDownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;!!!ERROR: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Async implementation 2</strong>: This function runs the async computation synchronously on a <code>ThreadPool</code> thread because that&#x27;s what <code>ExcelAsyncUtil.Run</code> does. Blocking calls will block a <code>ThreadPool</code> thread, eventually limiting the concurrency of the async calls</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncTP2 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;downloadStringAsyncTP2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RunSynchronously </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Async implementation 3</strong>: Use the helper we defined above. This runs the async computation using true F# async. Should not block <code>ThreadPool</code> threads, and allows cancellation</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsync url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelRunAsync </span><span class="token string" style="color:#e3116c">&quot;downloadStringAsync&quot;</span><span class="token plain"> url </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Helper that will create a timer that ticks at <code>timerInterval</code> for <code>timerDuration</code>, and is then done. Also not exported to Excel (incompatible signature). Notice that from F#, the <code>timer.Elapsed</code> event of the BCL <code>Timer</code> class implements <code>IObservable</code>, so can be used directly with the transformations in the F# <code>Observable</code> module.</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// setup a timer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timers</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoReset </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// return an async task for stopping it after the duration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timerStop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token computation-expression keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">do</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Sleep timerDuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Start timerStop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Make sure that the type we actually observe in the event is supported by Excel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// by converting the events to timestamps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Elapsed </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> elapsed </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Event implementation</strong>: Finally this is the Excel function that will tick away in a cell. Entered into a cell (<em>and formatted as a Time value</em>), the formula <code>=startTimer(5000, 60000)</code> will show a clock that ticks every 5 seconds for a minute.</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> startTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelObserve </span><span class="token string" style="color:#e3116c">&quot;startTimer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> float timerDuration</span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">createTimer timerInterval timerDuration</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="putting-everything-together-in-an-excel-add-in">Putting everything together in an Excel add-in<a href="#putting-everything-together-in-an-excel-add-in" class="hash-link" aria-label="Direct link to Putting everything together in an Excel add-in" title="Direct link to Putting everything together in an Excel add-in">​</a></h2><p>A complete <code>.dna</code> script file with the above code can be found in the <a href="https://github.com/Excel-DNA/ExcelDna" target="_blank" rel="noopener noreferrer">Excel-DNA distribution</a>, under <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/Distribution/Samples/Async/FsAsync.dna" target="_blank" rel="noopener noreferrer">Distribution\Samples\Async\FsAsync.dna</a>.</p><p>Alternatively, the following steps would build an add-in in Visual Studio:</p><ul><li>Create a new F# library in Visual Studio.</li><li>Install the Excel-DNA package from NuGet (<code>Install-Package Excel-DNA</code> from the NuGet console).</li><li>Set up the Debug path:<ol><li>Select “Start External Program” and browse to find Excel.exe, e.g. for Excel 2010 the path might be: <code>C:\Program Files (x86)\Microsoft Office\Office14\EXCEL.EXE</code>.</li><li>Enter the full path to the <code>.xll</code> file in the output as the Command line arguments, e.g. <code>C:\MyProjects\TestDnaFs\bin\Debug\TestDnaFs-addin.xll</code>.</li></ol></li><li>Place the following code in <code>Library1.fs</code>, compile and run:</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> FsAsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> Microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FSharp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Control</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WebExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> ExcelDna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Integration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// This class implements the IExcelAddin which allows us to initialize the ExcelAsyncUtil support.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// It must not be a nested class (e.g. defined as a type inside a module) but a top-level class (inside a namespace)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">FsAsyncAddIn</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">IExcelAddIn</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoOpen </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Initialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoClose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Uninitialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// a regular Excel UDF just to show that the add-in works</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> fsaAddThem </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Some utility functions for connecting Excel-DNA async with F#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> FsAsyncUtil </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# Async computation to Excel-DNA </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelRunAsync functionName parameters async </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// make something like CancellationDisposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> cts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CancellationTokenSource</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> disp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IDisposable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Dispose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cancel </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Start the async computation on this thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StartWithContinuations </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">   async</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">OnNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnError ex </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Token </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// return the disposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        disp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# IObservable to Excel-DNA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelObserve functionName parameters observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Subscribe to the F# observable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnNext </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> observable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Some test functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> TestFunctions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Plain synchronous download function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// can be called from Excel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;!!!ERROR: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Uses Excel-DNA async to run download on a ThreadPool thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncTP1 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;downloadStringAsyncTP1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Create an F# asynchronous computation for the download</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Not exported to Excel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncImpl url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token computation-expression keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// In here we could check for cancellation using </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// let! ct = Async.CancellationToken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// if ct.IsCancellationRequested then ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let!</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AsyncDownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;!!!ERROR: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// This function runs the async computation synchronously on a ThreadPool thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// because that&#x27;s what ExcelAsyncUtil.Run does</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Blocking calls will block a ThreadPool thread, eventually limiting the concurrency of the async calls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncTP2 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;downloadStringAsyncTP2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RunSynchronously </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// This runs the async computation using true F# async</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Should not block ThreadPool threads, and allows cancellation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsync url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelRunAsync </span><span class="token string" style="color:#e3116c">&quot;downloadStringAsync&quot;</span><span class="token plain"> url </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Helper that will create a timer that ticks at timerInterval for timerDuration, then stops</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Not exported to Excel (incompatible type)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// setup a timer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timers</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoReset  Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> elapsed </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Excel function to start the timer - using the fact that F# events implement IObservable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> startTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelObserve </span><span class="token string" style="color:#e3116c">&quot;startTimer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> float timerDuration</span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">createTimer timerInterval timerDuration</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="support-and-feedback">Support and feedback<a href="#support-and-feedback" class="hash-link" aria-label="Direct link to Support and feedback" title="Direct link to Support and feedback">​</a></h2><p>The best place to ask any questions related to Excel-DNA is the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>. Any feedback from F# users trying out Excel-DNA or the features discussed here will be very welcome. I can also be contacted directly at <a href="mailto:govert@dnakode.com" target="_blank" rel="noopener noreferrer">govert@dnakode.com</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/features">features</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/samples">samples</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/async">async</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/excel">excel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/exceldna">exceldna</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/fsharp">fsharp</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/3"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/installation">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/guides---basic">Guides - Basic</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/guides---advanced">Guides - Advanced</a></li><li class="footer__item">
                  <a href="https://www.youtube.com/user/govertvd" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                  <img src="/img/youtube.png" alt="YouTube" width="20.42" height="14.4" style="margin-right:5px;">govertvd
                  </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Discussions</div><ul class="footer__items clean-list"><li class="footer__item">
                    <a href="https://groups.google.com/g/exceldna" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                    <img src="/img/google_groups.png" alt="Google Groups" width="16" height="16" style="margin-right:5px;">exceldna
                    </a>
                </li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item">
                    <a href="https://github.com/Excel-DNA" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                    <img src="/img/github.png" alt="GitHub" width="16" height="16" style="margin-right:5px;">excel-dna
                    </a>
                </li><li class="footer__item">
                    <a href="mailto:govert@dnakode.com" target="_blank" rel="noreferrer noopener" class="footer__link-item"> 
                    <img src="/img/email.png" alt="GitHub" width="16" height="11" style="margin-right:5px;">govert@dnakode.com
                    </a>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 DNA Kode, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0d6c618f.js"></script>
<script src="/assets/js/main.e225714c.js"></script>
</body>
</html>