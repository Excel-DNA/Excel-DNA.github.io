<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://excel-dna.github.io/blog</id>
    <title>Excel-DNA Blog</title>
    <updated>2022-03-07T00:36:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://excel-dna.github.io/blog"/>
    <subtitle>Excel-DNA Blog</subtitle>
    <icon>https://excel-dna.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Excel-DNA 1.6 – .NET 6 / PackageReference / Anti-virus]]></title>
        <id>https://excel-dna.github.io/blog/2022/03/07/excel-dna-1.6-.net6-packagereference-anti-virus</id>
        <link href="https://excel-dna.github.io/blog/2022/03/07/excel-dna-1.6-.net6-packagereference-anti-virus"/>
        <updated>2022-03-07T00:36:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA version 1.6 is now available for testing as pre-release version 1.6.0-preview3 from the NuGet package repository. The extension libraries ExcelDna.Registration and ExcelDna.IntelliSense also have matching releases. ExcelDnaDoc should follow in the coming weeks.]]></summary>
        <content type="html"><![CDATA[<p>Excel-DNA version 1.6 is now available for testing as pre-release version 1.6.0-preview3 from the NuGet package repository. The extension libraries ExcelDna.Registration and ExcelDna.IntelliSense also have matching releases. ExcelDnaDoc should follow in the coming weeks.</p><p>The main focus for version 1.6 is to provide a first preview of the support for add-ins that target .NET 6. As a prerequisite to adding the .NET 6 target, we’ve also added support for new SDK-style project files and NuGet references (also great for projects that target .NET Framework). I’ve also taken the opportunity to tweak the Excel-DNA packing mechanism a bit in an attempt to avoid some of the false positive anti-virus detections we’ve seen recently. I’ll briefly discuss these (in reverse order) below, but first a word about our sponsors.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-sponsors">GitHub sponsors<a href="#github-sponsors" class="hash-link" aria-label="Direct link to GitHub sponsors" title="Direct link to GitHub sponsors">​</a></h2><p>Excel-DNA is now registered on GitHub sponsors – see <a href="https://github.com/sponsors/Excel-DNA" target="_blank" rel="noopener noreferrer">https://github.com/sponsors/Excel-DNA</a>. Thank you very much to everyone who has already signed up – your contributions are directly funding further development.</p><p>If you use Excel-DNA and would like to encourage future support and ongoing development, please sign up as a GitHub sponsor for the project. GitHub sponsors will also have access to a private repository of sample projects where I hope to add additional tools and documentation over time.</p><p>I had previously considered the .NET Core / .NET 6 support as a good point to switch to a commercial model for Excel-DNA. However, the benefits of being an open-source project with a permissive license have been significant. So, if possible, I hope to continue with the core library as free and open source software, where further development is funded by the sponsors.</p><p>For those in a corporate setting using Excel-DNA extensively or in a mission critical role, I also offer an annual corporate support agreement. Please contact me directly if you are interested in more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="anti-virus-false-positives">Anti-virus false positives<a href="#anti-virus-false-positives" class="hash-link" aria-label="Direct link to Anti-virus false positives" title="Direct link to Anti-virus false positives">​</a></h2><p>Over the last year we’ve seen a number of anti-virus and security programs identify Excel-DNA add-ins as security risks, including false positive detections that delete add-in files by the default Windows Defender service. It seems that these detections were triggered by some malicious Excel add-ins that have been built using Excel-DNA, with the anti-virus heuristics subsequently identifying all Excel-DNA add-ins as problematic. For some security vendors, including Microsoft, we’ve been able to report this false positive detection and they have updated their signatures accordingly. But in many cases the Excel-DNA version 1.5 add-ins are still being flagged.</p><p>It seems the main heuristic used to detect Excel .xll add-ins as problematic is the presence of executable assemblies as resources in the .xll library. Excel-DNA uses the packing of assemblies as resources in the .xll to simplify the add-in distribution, in many cases making possible a single file (or two files for 32-bit and 64-bit) add-in distribution.</p><p>For this version there are two changes which may help with these false positives.</p><p>The first is that packed files are now encoded, so that they are not detected as embedded executable code directly. In my testing that change removed the false positive detections at least in the Microsoft products. However, at least one other user has reported still seeing problems with this version, so it does not seem like bulletproof solution.</p><p>Another option has been contributed by user @Phundamentals (thank you!), to add a project property which disables the compression of packed files.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ExcelDnaPackCompressResources</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">ExcelDnaPackCompressResources</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Should these mitigations not be enough to reduce most false positives, we could also introduce an option where there are no packed files at all (currently the managed Excel-DNA assemblies are always packed).</p><p>There have also been some indications that signing the final add-in library helps reduce false positive detections.</p><p>In all cases I do encourage developers to report the false positives to their anti-virus or security vendor. Their software is mistakenly identifying and blocking legitimate add-ins from running.</p><p>Developers of malicious add-ins are welcome to contact me for sponsored licenses of an alternative add-in framework.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="packagereference-and-sdk-style-project-files">PackageReference and SDK-style project files<a href="#packagereference-and-sdk-style-project-files" class="hash-link" aria-label="Direct link to PackageReference and SDK-style project files" title="Direct link to PackageReference and SDK-style project files">​</a></h2><p>The main ExcelDna.AddIn NuGet package now supports references in SDK-style project files. For new projects, this means that a .dna file is no longer added to the project automatically, and if not present will be created and output at build time from project properties. Existing projects with customized .dna file(s) will work as they did before.</p><p>For a new project, a simple project file might look like this:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Project</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Sdk</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">Microsoft.NET.Sdk</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">PropertyGroup</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">TargetFramework</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">net472</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">TargetFramework</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- We don't need the extra 'ref' directory and reference assemblies for the Excel add-in --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ProduceReferenceAssembly</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">ProduceReferenceAssembly</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- We need all dependencies to be copied to the output directory, as-if we are an 'application' and not a 'library'.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         This property also sets the CopyLockFileAssemblies property to true. --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">EnableDynamicLoading</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">EnableDynamicLoading</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">PropertyGroup</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ItemGroup</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">PackageReference</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Include</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">ExcelDna.AddIn</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Version</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1.6.0-preview3</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">ItemGroup</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Project</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Various additional properties can be set in the project file – see the example here <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/Source/Tests/ExcelDna.AddIn.Tasks.IntegrationTests.TestTarget/SDKProperties/SDKProperties.csproj" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/ExcelDna/blob/master/Source/Tests/ExcelDna.AddIn.Tasks.IntegrationTests.TestTarget/SDKProperties/SDKProperties.csproj</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="net-6-support">.NET 6 support<a href="#net-6-support" class="hash-link" aria-label="Direct link to .NET 6 support" title="Direct link to .NET 6 support">​</a></h2><p>Excel-DNA version 1.6 (finally!) includes support for add-ins that target .NET 6. Most Excel-DNA features seem to work, including the COM-based features like RTD-based functions, ribbon and CTP extensions. However, there has been very limited testing and you should consider the .NET 6 support as an early preview.</p><p>Update the TargetFramework tag in an SDK-style project file to the .NET 6 (Windows) target:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">TargetFramework</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">net6.0-windows</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">TargetFramework</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or build for both .NET Framework and .NET 6, which allows you to test both targets:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">TargetFrameworks</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">net472;net6.0-windows</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">TargetFrameworks</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>End users of the add-in will need to have the .NET 6 runtime installed. (To include the runtime files as part of the add-in will not be supported, but an installer program might check and install the runtime.)</p><p>A hard limitation of the .NET core series of runtimes (.NET 5 / 6 / 7 etc.) is that only one version of a .NET core runtime can be loaded into a specific process. The core runtime can still be loaded concurrently with a .NET Framework runtime (e.g. .NET Framework 4.8), although this is not a configuration officially supported by Microsoft. Excel-DNA will try to support add-ins targeting a .NET Framework running together with .NET 6 add-ins, but there is not planned to be any support for the future .NET 7 runtime. Fortunately .NET 6 is a ‘Long-term Support’ (LTS) release and will be formally supported until the end of 2024, so we can keep targeting .NET 6 for a few years. There is also some work on the horizon that make ahead-of-time compilation of .NET libraries (like the Excel-DNA add-ins) viable, bypassing the concurrent runtime issues. So I do expect a future path beyond .NET 6, though that is not an immediate concern.</p><p>I look forward to bug reports, questions and other feedback about the .NET 6 support (including whether it works at all). Support for modern .NET has been a long time coming and ensures that Excel-DNA can take part in the exciting future evolution of .NET.</p><p>After 16 years I am still amazed by and deeply appreciate the support and enthusiasm for Excel-DNA. Last but not least I want to thank Sergey Vlasov for his calm and consistent efforts that are now driving the project forward.</p><p>-Govert</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label=".NET" term=".NET"/>
        <category label="Excel" term="Excel"/>
        <category label="ExcelDNA" term="ExcelDNA"/>
        <category label="XLL" term="XLL"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Update v 1.5 / Sponsors / Roadmap]]></title>
        <id>https://excel-dna.github.io/blog/2021/07/15/update-v1.5-sponsors-roadmap</id>
        <link href="https://excel-dna.github.io/blog/2021/07/15/update-v1.5-sponsors-roadmap"/>
        <updated>2021-07-15T11:49:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA version 1.5]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="excel-dna-version-15">Excel-DNA version 1.5<a href="#excel-dna-version-15" class="hash-link" aria-label="Direct link to Excel-DNA version 1.5" title="Direct link to Excel-DNA version 1.5">​</a></h2><p>A release candidate for the next version of Excel-DNA is now available for testing. Please try out this update, and let me know if you run into any problems or whether you are able to confirm that your add-in still works correctly. I expect to make a final release in a few weeks.</p><p>This update includes a completely new implementation of the core marshaling, replacing code that I initially wrote in 2005. I’ve also done some internal refactoring to prepare for supporting the .NET 5+ generation of runtimes. Finally, a few improvements were made to improve add-in load times when many functions are registered. Improved resilience in hostile anti-virus environments were also implemented since the last release.</p><p>Modernising the marshaling code has resulted in two notable changes of the minimum requirements for using Excel-DNA.</p><ul><li>Only .NET Framework versions 4.5.2 to 4.8 are supported, and</li><li>Excel 2007 or newer is required, dropping support for the oldest versions of Excel.</li></ul><p>UPDATE NOTE:
If you are updating the NuGet package on a project that currently targets an older version of .NET (e.g. .NET Framework 4.0), you should change the target framework for the project to .NET Framework 4.5.2 or later, before updating the NuGet package. Otherwise you may get one of the following problems:</p><ul><li>The package install script may not run when the new package is installed. This leaves the project with a file called “_UNINSTALLED_xxxxx-AddIn.dna”. In this case, uninstall the ExcelDna.AddIn package, update the project target framework, and then reinstall. You might need to restart Visual Studio to complete the package updates.</li><li>Error messages stating “Error CS0246 – The type or namespace name ‘ExcelDna’ could not be found (are you missing a using directive or an assembly reference?)”. This also indicates that the target framework is not supported and should be updated, after which the errors should be resolved.</li></ul><p>Apart from the new minimum requirements, the new release is a highly compatible update and you should not expect any issues or significant behaviour changes after updating.</p><p>Thank you to @ittegrat and @augustoproiete for their contributions to this version.</p><p>The following prerelease packages are available on NuGet:</p><ul><li>ExcelDna.AddIn.1.5.0-rc1</li><li>ExcelDna.Integration.1.5.0-rc1</li><li>ExcelDna.IntelliSense.1.5.0-rc1</li><li>ExcelDna.Registration.1.5.0-rc1</li><li>ExcelDna.Registration.VisualBasic.1.5.0-rc1</li><li>ExcelDna.Registration.FSharp.1.5.0-rc1</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-sponsors">GitHub Sponsors<a href="#github-sponsors" class="hash-link" aria-label="Direct link to GitHub Sponsors" title="Direct link to GitHub Sponsors">​</a></h2><p>Excel-DNA is now registered on the <a href="https://github.com/sponsors/Excel-DNA" target="_blank" rel="noopener noreferrer">GitHub sponsors</a> program. This lets you sponsor future Excel-DNA development, and also gives access to direct support for your Excel-DNA projects.
Billing for the monthly sponsorship is through your GitHub account, making it easy to add sponsorship of open-source projects to a corporate GitHub account.</p><p>If you are using Excel-DNA and would like to see further development and ongoing support, please sign up as a sponsor.
A big thank you to those users who were the first to do so: @PierreYvesR, @terryaney, @mhouldsworth @KoosBusters and one private sponsor.</p><p>I’ve set up three levels of monthly sponsorship subscriptions:</p><ul><li>Individual – $14 pm. For power users and developers making add-ins for personal or limited use.</li><li>Team – $170 pm. For smaller development teams in a company, those publishing add-ins externally or using more advanced add-in features.</li><li>Corporate – $850 pm. For larger companies with mission critical applications or multiple development teams.</li></ul><p>For the Team and Corporate sponsorship levels I am also available for some monthly direct support sessions to help deal with problems or advise on your add-in projects.</p><p>The direct corporate support contracts are available as before, with bespoke agreements and extensive direct support.
Thank you very much to the existing corporate partners who have supported Excel-DNA over the past decade and continue to ensure the project’s viability.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="roadmap">Roadmap<a href="#roadmap" class="hash-link" aria-label="Direct link to Roadmap" title="Direct link to Roadmap">​</a></h2><p>The development work for Excel-DNA will next address two areas:</p><ul><li>Improved support for SDK-style project files and a PackageReference import of the main NuGet package. The newer .NET project templates and build tools are based on the SDK-style project files, so updating to support these even when targeting .NET Framework will be a big step forward. The main hurdle so far has been the install script and build tasks which depend on the older packages.config style NuGet implementation.</li><li>Support for the .NET 5+ generation of runtimes. I’ve made some progress towards the new add-in hosting code required for loading the .NET 5+ runtime, but getting to an implementation that can be supported for the future and work together with existing add-ins still needs a lot of work. The .NET 5+ runtime versions have more limited isolation capabilities, and different versions cannot be loaded side-by-side in the process. This might require us to standardise on a specific version like the .NET 6 Long Term Support release as the single supported .NET 5+ runtime target.</li></ul><p>Thank you for your ongoing enthusiasm for Excel-DNA and the super-power combination of .NET and Excel. I look forward to your thoughts and feedback.</p><p>-Govert</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label=".NET" term=".NET"/>
        <category label="Excel" term="Excel"/>
        <category label="ExcelDNA" term="ExcelDNA"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA version 1.1]]></title>
        <id>https://excel-dna.github.io/blog/2020/06/29/excel-dna-version-1.1</id>
        <link href="https://excel-dna.github.io/blog/2020/06/29/excel-dna-version-1.1"/>
        <updated>2020-06-29T18:53:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA version 1.1 is now available on NuGet and as a direct download from GitHub. The easiest way to install is with Visual Studio’s NuGet package manager (package ExcelDna.AddIn) – a ‘ReadMe’ file with further instructions will then be displayed. From the Package Manager Console:]]></summary>
        <content type="html"><![CDATA[<p>Excel-DNA version 1.1 is now available on <a href="https://www.nuget.org/packages/ExcelDna.AddIn/" target="_blank" rel="noopener noreferrer">NuGet</a> and as a direct <a href="https://github.com/Excel-DNA/ExcelDna/releases" target="_blank" rel="noopener noreferrer">download from GitHub</a>. The easiest way to install is with Visual Studio’s NuGet package manager (package ExcelDna.AddIn) – a ‘ReadMe’ file with further instructions will then be displayed. From the Package Manager Console:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Install-Package ExcelDna.AddIn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Excel-DNA 1.1 is expected to be the final version to support older .NET (&lt;4.5) and Excel (&lt;2007) releases.</p><p>Excel-DNA version 1.1 implements workarounds for two recent changes in Excel behaviour:</p><ul><li>RTD servers based on ExcelRtdServer, and streaming functions based on IExcelObservable stopped updating after recent (early 2020) Excel updates.</li><li>When loaded into an elevated Excel process (running As Administrator) the on-demand COM registration (used for ribbon and CTP loading) started failing (mid 2020).</li></ul><p>The update also introduces strong-naming of the Excel-DNA assemblies (thanks to @augustoproiete)</p><p>Please post any issues you run into to the Google group (<a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">https://groups.google.com/forum/#!forum/exceldna</a>)</p><p>To make a donation to the project, or to arrange for a corporate support agreement that lets you steer the future of Excel-DNA, please visit the <a href="/#support">Excel-DNA Support</a> page.</p><p>Thank you for your continued support and enthusiasm towards the Excel-DNA project!</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="release" term="release"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Getting started (or: Why Are You Still Using VBA?)]]></title>
        <id>https://excel-dna.github.io/blog/2019/08/11/getting-started-or-why-are-you-still-using-vba</id>
        <link href="https://excel-dna.github.io/blog/2019/08/11/getting-started-or-why-are-you-still-using-vba"/>
        <updated>2019-08-11T19:57:00.000Z</updated>
        <summary type="html"><![CDATA[I discovered a really nice write-up on “Excel-DNA Or Why Are You Still Using VBA?” by Efrem J. Sternbach. He gives a succinct one-page introduction to various Excel-DNA features including the ribbon integration and COM interop. A great start if you’re curious about Excel-DNA and still using VBA :-)]]></summary>
        <content type="html"><![CDATA[<p>I discovered a really nice write-up on “<strong><a href="https://medium.com/@efrem.sternbach/excel-dna-or-why-are-you-still-using-vba-a76f565884ff" target="_blank" rel="noopener noreferrer">Excel-DNA Or Why Are You Still Using VBA?</a></strong>” by <strong>Efrem J. Sternbach</strong>. He gives a succinct one-page introduction to various Excel-DNA features including the ribbon integration and COM interop. A great start if you’re curious about Excel-DNA and still using VBA :-)</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA version 1.0]]></title>
        <id>https://excel-dna.github.io/blog/2019/03/17/excel-dna-version-1.0</id>
        <link href="https://excel-dna.github.io/blog/2019/03/17/excel-dna-version-1.0"/>
        <updated>2019-03-17T21:08:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA version 1.0 is now available on NuGet and as a direct download from GitHub. The easiest way to install is with Visual Studio’s NuGet package manager (package ExcelDna.AddIn) – a ‘ReadMe’ file with further instructions will then be displayed. From the Package Manager Console:]]></summary>
        <content type="html"><![CDATA[<p>Excel-DNA version 1.0 is now available on <a href="https://www.nuget.org/packages/ExcelDna.AddIn/" target="_blank" rel="noopener noreferrer">NuGet</a> and as a direct <a href="https://github.com/Excel-DNA/ExcelDna/releases" target="_blank" rel="noopener noreferrer">download from GitHub</a>. The easiest way to install is with Visual Studio’s NuGet package manager (package ExcelDna.AddIn) – a ‘ReadMe’ file with further instructions will then be displayed. From the Package Manager Console:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Install-Package ExcelDna.AddIn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Excel-DNA 1.0.x series (this version with minor fixes) will be the final version to support older .NET (&lt;4.0) and Excel (&lt;2007) releases.</p><p>Version 1.0 is essentially the same as the long-overdue version 0.35. The update includes a number of bug fixes as well as improvements to the build-time Visual Studio integration:</p><ul><li>Improve build tasks – more reliable clean-up and debugger detection</li><li>Improve RTD and async QueueAsMacro reliability</li><li>Improve install process of ExcelDna.AddIn NuGet package (now requires NuGet 2.5) (thanks to @caioproiete)</li><li>Change how ExcelDnaUtil.Application works in Protected View – try harder but don’t cache</li><li>Call UnhandledExceptionHandler for macros (ExcelCommands) too</li><li>Add XML schema for .dna file (thanks to @caioproiete)</li><li>Add option to pack .pdb files (thanks to @lanfeust69)</li><li>Fix exception handling from native async functions (thanks to @ittegrat)</li></ul><p>Please post any issues you run into to the Google group (<a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">https://groups.google.com/forum/#!forum/exceldna</a>)</p><hr><p>To make a donation to the project, or to arrange for a corporate support agreement that lets you influence the future of Excel-DNA, please visit the <a href="https://excel-dna.net/support/" target="_blank" rel="noopener noreferrer">Excel-DNA Support</a> page.</p><p>Thank you for your continued support and enthusiasm towards the Excel-DNA project!</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="release" term="release"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Develop Excel Conference – London, 18 October 2018]]></title>
        <id>https://excel-dna.github.io/blog/2018/09/21/develop-excel-conference</id>
        <link href="https://excel-dna.github.io/blog/2018/09/21/develop-excel-conference"/>
        <updated>2018-09-21T09:05:00.000Z</updated>
        <summary type="html"><![CDATA[Charles Williams of FastExcel fame is hosting a one-day conference in]]></summary>
        <content type="html"><![CDATA[<p>Charles Williams of <a href="https://fastexcel.wordpress.com/" target="_blank" rel="noopener noreferrer">FastExcel</a> fame is hosting a one-day conference in
London on 18 October, covering a wide range of Excel extensibility topics.</p><p>I will be presenting Excel-DNA, joining developers responsible for PyXLL,
Planatech XLL+, the new Javascript interfaces from Microsoft, and more.
Anyone interested in advanced Excel extensibility will get great insights
into the present and future of developing Excel-based solutions.
Please join us!</p><p>This is a community organized pay-if-you-can event, with contributions helping to defer speakers’ travel expenses.</p><p>Find all the details and registration info at:
<a href="https://developexcel.wordpress.com" target="_blank" rel="noopener noreferrer">https://developexcel.wordpress.com</a></p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA version 0.34]]></title>
        <id>https://excel-dna.github.io/blog/2017/05/31/excel-dna-0-34-final-testing</id>
        <link href="https://excel-dna.github.io/blog/2017/05/31/excel-dna-0-34-final-testing"/>
        <updated>2017-05-31T01:12:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA version 0.34 has been released and is now available.]]></summary>
        <content type="html"><![CDATA[<p>Excel-DNA version 0.34 has been released and is now available.</p><ul><li>on NuGet (as package ExcelDna.Addin 0.34.6), and</li><li>as a standalone download from GitHub (<a href="https://github.com/Excel-DNA/ExcelDna/releases/tag/v0.34.6" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/ExcelDna/releases/tag/v0.34.6</a>).</li></ul><p>Please post any issues you run into to the Google group (<a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">https://groups.google.com/forum/#!forum/exceldna</a>)</p><p>The easiest way to test the new version is by installing (or upgrading to) the <code>ExcelDna.AddIn</code> NuGet package.</p><hr><p>Excel-DNA version 0.34 introduces a much improved build procedure for add-ins created using the NuGet package (thanks to a fantastic work by <a href="https://github.com/caioproiete" target="_blank" rel="noopener noreferrer">@caioproiete</a>!)</p><p>This replaces the error-prone post-build steps we had with a custom build helper and allows easier build output customization (see <a href="https://github.com/Excel-DNA/ExcelDna/wiki/Build-Output-Customization" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/ExcelDna/wiki/Build-Output-Customization</a>).</p><p>Various bug fixes and smaller improvements are also included in this version:</p><ul><li>Add <code>ExplicitExports="false"</code> to NuGet .dna file template</li><li>Fix getting <code>Application</code> from <code>ProtectedViewWindow</code></li><li>Add attempts to get <code>Application</code> object from all windows of class <code>EXCEL7</code>.</li><li>Fix <code>ExcelAsyncUtil.Observe</code> re-open restart - broken by other fixes in the previous version. Add option to not restart.</li><li>Change <code>ExcelRtdServer.ConnectData</code> to be more careful about raising an update notice. Calls to <code>Topic.UpdateNotify</code> during the <code>ConnectData</code> overload are now always ignored. If the topic value is updated (through <code>Topic.UpdateValue</code>) during ConnectData, and the same value is returned from ConnectData, then no spurious <code>UpdateNotify</code> is raised. If the value returned from <code>ConnectData</code> differs from <code>Topic.Value</code>, <code>UpdateNotify</code> will still be raised.</li><li>Allow <code>AccessViolation</code> exceptions to be caught under .NET 4.0 - change marshaling wrapper from <code>DynamicMethod</code> to <code>MethodBuilder</code>.</li><li>Fix <code>QueueAsMacro</code> failure after paste live preview.</li><li>Fix <code>AssemblyResolve</code> re-entrancy race condition.</li></ul><hr><p>To make a donation to the project, or to arrange for a corporate support agreement that lets you ensure Excel-DNA will live on, please visit the <a href="/#support">Excel-DNA Support</a> page.</p><p>Thank you for your continued support and enthusiasm towards the Excel-DNA project!</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel UDF IntelliSense for Excel-DNA and VBA]]></title>
        <id>https://excel-dna.github.io/blog/2016/11/24/excel-udf-intellisense-for-excel-dna-and-vba</id>
        <link href="https://excel-dna.github.io/blog/2016/11/24/excel-udf-intellisense-for-excel-dna-and-vba"/>
        <updated>2016-11-24T11:44:00.000Z</updated>
        <summary type="html"><![CDATA[I'm happy to announce the first official release of the IntelliSense extension!]]></summary>
        <content type="html"><![CDATA[<p>I'm happy to announce the first official release of the IntelliSense extension!</p><p><strong>Excel-DNA IntelliSense</strong> provides on-sheet help for UDF functions as they are entered into a cell formula, similar to the help available for built-in Excel functions.</p><p><img loading="lazy" alt="Intellisense Release v1 01" src="data:image/png;base64,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" width="557" height="287" class="img_ev3q">
<img loading="lazy" alt="Intellisense Release v1 02" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZwAAACCCAMAAABFNI5UAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKIUExURQAAAAAAOgAASAAAZgAAdAA6kABISABInABmtgB0nAB0vyFzRiFzYyFzfiGGmCGZfiGZsToAADoAOjoAZjo6kDqQtjqQ20REREREZ0REiERnqESIxUdzRkesyEgAAEgASEgAdEhISEhIdEhInEh0dEh0v0icnEicv0ic4GRkZGYAAGYAOmZmOma2tma2/2dERGdEiGdnqGeIxWeo4mlzRmmZfnQAAHQASHQAdHRInHR0AHR0dHR0v3Sc4HS/v3S/4HS//3Z2dnh4eIGBgYhERIhEZ4hEiIiIxYjF/4mGRonP4Y6OjpA6AJA6OpCQZpCQkJDbtpDb/5aWlpubm5xIAJxISJxIdJx0AJycSJzgv5zg4Jzg/6eZRqfPmKfh4ahnRKhnZ6iIRKioxajF/6ji/6urq6ysrK6urq+vr7CwsLGxsbOzs7S0tLW1tbZmALa2trbbkLb/27b//7e3t7i4uLm5ubu7u729vb6+vr90AL90SL+cnL+/dL+/v7/gnL//4L///8DAwMHBwcPDw8SsY8ThyMTh4cWIRMXFxcX//8bGxsfHx8jIyMnJycrKysvLy83Nzc/Pz9DQ0NHR0dLS0tTU1NXV1dbW1tfX19jY2NnZ2dra2tuQOtvbkNvb29v/ttv//9zc3N3d3d7e3t/f3+CcSOC/dODgnODg4OD/v+D/4OD//+G+fuHPmOHhseHhyOHh4eKoZ+Li4uL//+Pj4+Tk5OXl5ebm5ufn5+jo6Onp6erq6uvr6+zs7O3t7e7u7u/v7/Hx8fLy8vPz8/X19fb29vr6+vz8/P39/f7+/v+2Zv+/dP+/nP/FiP/bkP/gnP/iqP//tv//v///xf//2///4P//4v///yIUYUsAAA3aSURBVHja7Z2PfxRHFcCXEJr2Yqv4g2hb0mKLnqmiFU1Lq3Zrq1KpP1oDQk+tP6BSSKtSAQ+ppKBCBQQsUIuoxGRbIf5IMAarrW1oC4GT5gcN++/43vzand292bubEJbkzSd3k52bNzM73503s+/N3jk+hcwGh7qA4FAgONMFzjO9duEZy5a9SvLl4eyzhLPPsnGvkHx5OHst4ey1bNzLJF8ezh5LOHssG/cSySfDeQ1eu41d//f7Gq/5pTHHbsvG/ZvkE+G81g1vO41d/9frG9/2RWOOnaaaz9/b1PTelcbGvWhu+4WHm5re93SN8li9Vf0VFGBuPytgYYq8k8gG4ewwdv3PGz/ZONeYY4exbZ9b6Z+79h+mLCdSTg7ObOR7Ncpj9f65psU1188KMIeU9qcWcCIRDrBBONvMWu3qb15v1mvb0to2cqsRzoCx6dsXpnXOQGrXmK+OAUs4A5ZwBpLgIBuEs9Ws1a75xX1mvbY1rW195v7tN8p//um0zulP7RpzB/Vbwum3hNOfAIexQThPmrXaXPYyhCfTVK5Zq/nHTR+OfCwVznFLOMdTpwzjlGeW5wUsTpF3EtkgnI3mtRoGo17bmDrnmE+u13Lk9KbDMRbSazlyei1HTm8MjmCDcDaY12oYjHptQ1rbUtrXbV6rLU7rnO7Urum7rub6K4DTbQmnOwpHssGC1xu12jvg/RtGvbbecuR0GZvOllrG1VpXWtf0mZfCXZZwuizhdEXgKDYI5wmjVpvLEJn02hOW9zmd5raPfDRl1upM0/gpc15n6pRhnjM6LeF06nACNgjnMUvzzWOWd8h/IHknkQ3CWWsJZ61l4w6RfHnD5xpLOGssG/ccyZeHs9oSzmrLxj1L8mXhNNoHu8Yd9Ke9vHNg/2/27d3z612/2rFt61M/2bhh/Y9/0L52zervTwCcVRTsglNOK9le+OVDhS7SA5bVTAF5gkNwCA7BITgE51LA+Uvj1d9Kh3N21hEt9v237l9gqOTwHIJjDQd9NGXhPO4siMP5Y4uDYeaPTHBGb3kACTlzCI4VnLd/ohyc0Vs+fGXiyHnznQ+kjBzMNtrynvsJjp1a+1tZOGdn/f5d6yB+c7Yz48vQ2zKWcD7S4sxg/8A4Wue/9aWvtuB4YmmPX8k1H8GZYDhnmdqaBT08h/Uuvo22zDoiYwUHKCAEfB3Gj2euA04L+P9zCM5FHTmI4DAOGBw+oKdkHFZrmIwHMMew48MA6uzMdaMtCwjORYXDwEDPQ2czCjKOwpmNA20GwZlMtYZTCYQ5qSOHzUvimOBMzsg5O4OthrGnAdDsWUdkHIEjCYThaHMOXxwQnImEw/sUxwAorpk/fPcRFetw2GrNQUgBHCY82sJHHsHJmPkmMCT4Qu0RnMzA4RaCsCGH4GQGDtnWsgwnFghOxXAuzh4Cvj/kAAWrcJF23/j2229o5Bj2ra2yKprgZBgOdS7BmbZwPkRhkkItcHwKkxIqgdOnP4JKcDIE5/wX9KckCU6WRg6E8Pc2EJyMwTkXHznjbXmRML60wKOH2tADULfi9o7EUsfb3LCYIYgSIYy1OiL/cHMuFOkBEov5KQjn5Bunhs6kwdG+ekHAGb5ZMlBwICpB142VgVPKa2IVwSk5TkNPJXDGKij2soNzqH/wVBqcPu35YgHHc4tuVXB4tkCsIjjF+jvqCpXA8Sso9rKD076z//WhlNXawoSl9PiyDgSBl/ZV0JUiEnA2O46LXebUd+BB/ZY2uP7HFvUoseGbethLiKmcKCaL4lotV0K95qG+zMkIskPicPMVKCYTS7mpB+dr7YdOmuGMfDzpPgf6AkfI8A0Apq4gIgGnFbqqoYd1fg4PvLoCzDfD80NiHI6UVjlRTBbFtZo71gppzQgmp6K8XwSp5oYez8mLRFbkVIPzlUcODp42wjnXpH+/G4eDWgReCAOUkIgCtQavEl7RDUfhABOLHI4QE3CktMqJYrmQWiuyFUbBgxEFEFSEwUUqJUcmTkk4S1YdSIGTaCGAVRRXNLwrvSQ4TM+MaXCkmIDjBWiVmBeCg4MDhkU+CseVEw3BSYLD+nPstsLwjR1MMfFIg4P6KQwH5xwpBn++B+pKSKucKCaLwtUDzjdA6Hk238D0IyJA9tMeAUckTsk5p0Y4fG0ENxcen749bUHQwZnAIMkHcHA4hMVuvqlHiqmc+OJpOM7G2xx2Z1RXAPV2Ba7IeITZGyQcmTgVV2s1wqkllBLvE8ssvEtV9vWUvM8pC2fw1Vf++/JL/3nxXycG/tnf++furj91/u7Qc7999mDNcJiFIBa8hsS5YlOhusKnpIXg7iWP7tpfzR6CibSt4fqgfupd8ZejWqNAcAgOBYJDcAjOZQxnu/6dpAQnQ3AufBf4mDyh8TDcLBfIxnvDIFvCItut4V4z7FmqbW1fza1s9dVUeadcoVpLcFObXJrBHaFoTsS2Ig7L3TiWs8RAun560YwJcKqz6tjBMdcVa/1Ewdm+OAbH5NIMPjHDcQmOLZxz+rdY655Q5dUEKyUz3sMtP5gicyKVN6fIDZXwEctV5BsDtGwh52lROHfQ4ekqvyov5Sg/wmJyviiHH+g+Wd4aLvN1aBaYuj1XlOgrZ22oduGtxfSccuIur3tIlOPLamL+WsxVUO1+QZa4HPa5qKa6eut58aJIN9aIqkfOtdGtUcKlGcBhqLhPM+ROC0YO/4gDDUaOzMa9oOhJUNcYOhLQu8A/kunqKDBy8wPdJ6scCJDFAyP4PFdk4VWEnLWidu6txf9gupOu2XzEEQFlxPy1mCt+2pAocoZbovmIfeF4iTWiWjjh38XQPKFB4eg89rlPsycJDv/oBcyVACfsnxNw2IGnPAmBYpDuCFeWww50nyxrjarj2LLNeXAniRL9wHcU1C58TliRlw9cs6ocWc1Y1F8rWxM7bVlHqCWaj7jH56XHGlENHPzVhr7oyJEuzQAOusbcoHfjcMQV5AWdGjsZr1I4OHiKshx+EPXJCn8pZBlfuuJTY4ueF8OgIji5YALypFrj1cT8tVI46Xx4EUFL9GtQ9IYVnOjvDWmeUPHO7f6lHPdpsnbw1JBau0Fu2siF4ISyKedpRK0lwfGY9hHl8IOoT9YPNKh3p+tvmlfwQ2qNFxOqXcBBdXRbyDWrypHVxPy1cptL0vmIIlRL9NMUvRFrhHK4W3tCGX30apaY9Z/5NHmPsFR5gjCK2UcyF4OpZxP6gX98VKmuEJyS2gUCA7f+DleUIw40n2xJ+iIwC+tJzMlLDOCEapcjZ7mc7oUTF8thW1NENbq/ViLkp4116efDdVh9pPUiuy9ON9oIazjTKpQukQec4FQQNhUIDoWK4Uz8HgIK1cK5pHsIKJBaIzgUsgQneOisxP8pOXEXQJAWvvOq3rWRstu2TGnmSqBFeMuEeQwZRcVa/ZO09dcCjifMN8o+oQwdoZCUph4CqSZ4xk2DCaXFK0kggDZBzGNojahYq9/LZxzOcPNVbdxYPN4m7N9xv2ZSmrJdT+C9RkJp8UoSCJRyIfOwsWKt/km68akMzvl74862IjgfoOfRJQFWCxGhPbThWFv9ZjRP8LRjgo/Hdq+73GgBj9zki2h7QQGXD0NXHMB7XYG9+SITFiQLYQnCJO7d1YYPT6El9QNMx/ICip9pzWmVcHmWAojmSwsltsjFP1+X931Zox7xT4PGZAROX1MMjni8DIcGbPcXEfokinUrWtlDaKGPfG7Gl1eux07RFQpfPoYo7Lts9wC+gTWsOM8FsyDuVmDPLEIn8gQwamFmfLxtHnqSWFU3itJEhUElUt6THo7SvDx/6oH/8QGu5H2+PwIk9EiWrhqTDTgjt34nBkc9c5bnTzeJSHvkLM8fsJEKH02+PufErLfCs8Hs263CGRRSM2O3b1l6l7Swc70zzhOwc9DIDmUwm2ZeK43bncOVcHnhVR5bdGzZzz7NbfRqPaC3xhcSkUg1b7IeBaoEzoVvr4ztIRhuZhZlFy5evIBDEV+hBR+FFX4xF56qQcEEMyt8xA/Yu8ecUMLniweaXw87x8upWaUoXSK8AD5AI5WA/VysB9CzMzyfKzb4kFmcNXlRPT5ElJeeVBn5ftCYbMDZvjC2wYOrjhJ7IBA3OKko7/+PPcFZZA9yQtqWNs6nlFfrJdmpqPOVxxydNOyAOdzgDfy17CrN44F41C2U4LjSNYUetjxThNKr5Ecq4fJCq44vfX/H2J34lF1e/LFMgTyvHiUikWxeSXcmX1I4uC0qCsdz+GPuMEPAY2X1HSLCyRJWAHwq4mkKjvNBuVcCMYopXezN4Jsg+AG817H9GerKhYLEs+9BQm5TQYDBGUD4acS2j2glQl7skmOTRivz2eT5n/LziNb4UkKPxAaPVr5/JBtwLjyMT1M3LSQLQVYtBAn71igQHIJDhk+CQ4HgTG84FCYp1LCHgLmxd7c/eM9n76ZwUcM9D7bvrnIPAXt/o39n+yOraglLVtmFaSRfwZfhJcI5Ndh/6GBNP2HxqOVPYEwj+Uq+RjIJztCp108O1hR2DdqFaSRf0RewJsA5c2Zo6HRNYf9puzCN5IeGzsTY0A9NZFye4FwecOC3DJquIzgZhbOYRk5m4WwnOBmGE/mJFuqcbC0ItAd2qXOyBQc24BCcrMLRvoeAOic7cGK/PEWdkyE40e8hoM4hCwHJExyCQ51LcKYNnJQ9BBQuYaCRQ2qN5AkOwaHOJTgkT3CyLP9/+OEccAuIcs8AAAAASUVORK5CYII=" width="412" height="130" class="img_ev3q"></p><p><strong>For Excel-DNA add-ins</strong> (v0.32 and later) that already provide descriptions in the <code>[ExcelFunction]</code> and <code>[ExcelArgument]</code> attributes, no extra work is needed. Just download and open (or install) the latest <code>ExcelDna.IntelliSense.xll</code> add-in from the GitHub (<a href="https://github.com/Excel-DNA/IntelliSense/releases" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/IntelliSense/releases</a>), and the IntelliSense will light up. (There is also a NuGet package for embedding the service into your add-in, making distribution a bit easier.)</p><p><strong>For VBA functions</strong>, you can add an extra sheet with the IntelliSense descriptions, or add an external .xml file with the information, or embed as a the <code>CustomXML</code> part in the Workbook or <code>.xlam</code> add-in.
Then open (or install) the <code>ExcelDna.IntelliSense.xll</code> add-in to provide the display service. Charles Williams, of <a href="http://www.decisionmodels.com/fastexcelD.htm" target="_blank" rel="noopener noreferrer">FastExcel</a> fame, has a detailed write-up on adding IntelliSense for your VBA function - see <a href="https://fastexcel.wordpress.com/2016/10/07/writing-efficient-vba-udfs-part-15-adding-intellisense-to-your-udfs/" target="_blank" rel="noopener noreferrer">https://fastexcel.wordpress.com/2016/10/07/writing-efficient-vba-udfs-part-15-adding-intellisense-to-your-udfs/</a>.</p><p><strong>For PyXLL users</strong>, the latest PyXLL 3.1 release offer built-in support for IntelliSense with the ExcelDna.IntelliSense.xll add-in installed. See <a href="https://enthought.pyxll.com/whatsnew.html#intellisense" target="_blank" rel="noopener noreferrer">https://enthought.pyxll.com/whatsnew.html#intellisense</a>.</p><p>Other native .xll add-ins can also provide IntelliSense through an external .xml file.</p><p>Details and downloads are on GitHub:</p><ul><li>Home: <a href="https://github.com/Excel-DNA/IntelliSense" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/IntelliSense</a></li><li>Releases: <a href="https://github.com/Excel-DNA/IntelliSense/releases" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/IntelliSense/releases</a></li><li>Getting Started: <a href="https://github.com/Excel-DNA/IntelliSense/wiki/Getting-Started" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/IntelliSense/wiki/Getting-Started</a></li><li>Detailed Usage Instructions: <a href="https://github.com/Excel-DNA/IntelliSense/wiki/Usage-Instructions" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/IntelliSense/wiki/Usage-Instructions</a> including details for incorporating the library into your own add-in for easier distribution.</li></ul><p><strong>Public support and bug reports</strong>:
The Excel-DNA Google group (<a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">https://groups.google.com/forum/#!forum/exceldna</a>) is the best place for general questions, comments etc. Detailed bug reports and feature requests can be added to the GitHub issues list: <a href="https://github.com/Excel-DNA/IntelliSense/issues" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/IntelliSense/issues</a></p><p><strong>Corporate support and private donations</strong>:
If you find Excel-DNA and extensions like the IntelliSense service useful, please support the project by arranging a corporate support agreement, or making a donation via PayPal. See <a href="/support/">https://excel-dna.net/support/</a> for details and contact information.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Add-in spotlight: ACQ for interpolation]]></title>
        <id>https://excel-dna.github.io/blog/2016/06/10/add-in-spotlight-acq-for-interpolation</id>
        <link href="https://excel-dna.github.io/blog/2016/06/10/add-in-spotlight-acq-for-interpolation"/>
        <updated>2016-06-10T21:23:00.000Z</updated>
        <summary type="html"><![CDATA[This is the first in an occasional series of posts about interesting Excel-DNA based add-ins.]]></summary>
        <content type="html"><![CDATA[<p>This is the first in an occasional series of posts about interesting Excel-DNA based add-ins.</p><p>Alex Chirokov's <strong>ACQ</strong> add-in provides a library of interpolation routines for Excel. The add-in includes 1D and 2D interpolators, scatter plot smoothing and a Mersenne Twister random number generator.</p><p>To have a closer look:</p><ul><li>Find the current release on GitHub: <a href="https://github.com/ratesquant/ACQ/releases" target="_blank" rel="noopener noreferrer">https://github.com/ratesquant/ACQ/releases</a></li><li>With the main repository on GitHub at <a href="https://github.com/ratesquant/ACQ" target="_blank" rel="noopener noreferrer">https://github.com/ratesquant/ACQ</a></li><li>A very clear introduction to the library, including some of it's advanced features, is posted on Code Project: <a href="http://www.codeproject.com/Articles/1097174/Interpolation-in-Excel-using-Excel-DNA" target="_blank" rel="noopener noreferrer">http://www.codeproject.com/Articles/1097174/Interpolation-in-Excel-using-Excel-DNA</a></li></ul><p>Features I like about the add-in (apart from it using Excel-DNA) include:</p><ul><li>A liberal open-source license</li><li>A clear and authoritative implementation of a particular domain</li><li>Very nice example of using object handles - an interpolator is build from the data, and then used to interpolate many values. ACQ has a clean implementation and great example of this technique.</li><li>All the functions have a common prefix ("<code>=acq</code>..."), making them easy to find in the function list, and use with the Excel-DNA IntelliSense extension.</li></ul><p>Thank you for publishing a great add-in, Alex.</p><p>PS: ACQ has a bonus feature that implements a Sudoku solver (and generator)! See the write-up here: <a href="http://www.codeproject.com/Articles/1098156/Sudoku-Solver-in-Excel-using-Csharp-and-Excel-DNA" target="_blank" rel="noopener noreferrer">Sudoku Solver in Excel using C# and Excel-DNA</a>.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA version 0.33.8-rc2 available]]></title>
        <id>https://excel-dna.github.io/blog/2015/09/03/excel-dna-version-0-33-8-rc2-available</id>
        <link href="https://excel-dna.github.io/blog/2015/09/03/excel-dna-version-0-33-8-rc2-available"/>
        <updated>2015-09-03T17:25:39.000Z</updated>
        <summary type="html"><![CDATA[I've made an updated release candidate available - this is version 0.33.8-RC2.]]></summary>
        <content type="html"><![CDATA[<p>I've made an updated release candidate available - this is version 0.33.8-RC2.</p><p>In this update:</p><ul><li><p>Excel-DNA is (again) licensed under the <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/LICENSE.txt" target="_blank" rel="noopener noreferrer">zlib license</a> (thanks to <a href="https://groups.google.com/forum/#!topic/exceldna/CRsJrQ6mJTo" target="_blank" rel="noopener noreferrer">Chel</a> for raising the potential ambiguity in the MIT license).</p></li><li><p>There are improvements in the NuGet install scripts (thanks to <a href="https://github.com/caioproiete" target="_blank" rel="noopener noreferrer">Caio Proiete</a> for the encouragement and help with this).</p></li><li><p>There are some minor fixes, including the <code>XlCall</code> fix for the error: "<em>Cannot Inherit from sealed class XlCall</em>"</p></li><li><p>The VC++ native project was updated to use the VS 2013 tools (allowing the project to build with the AppVeyor continuous integration service).</p></li></ul><p>The update can be installed by:</p><ul><li><p>Updating the Excel-DNA NuGet package to pre-release version 0.33.8-rc2</p></li><li><p>Installing the new (pre-release) <code>ExcelDna.AddIn</code> package version 0.33.8-rc2</p></li><li><p>Downloading the binary (and source) distribution from CodePlex (<a href="https://exceldna.codeplex.com/releases/view/616591" target="_blank" rel="noopener noreferrer">https://exceldna.codeplex.com/releases/view/616591</a>).</p></li></ul><p><strong>Please help me test this update!</strong></p><p><strong>You can notify me of any problems or questions you encounter, either through the <a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">Google group</a> or directly via email to <a href="mailto:govert@dnakode.com" target="_blank" rel="noopener noreferrer">govert@dnakode.com</a></strong>.</p><p><strong>Please also confirm if it works!</strong>
<strong>What Windows and Excel version, and what features do you use?</strong></p><hr><p>Thank you for your continued support of Excel-DNA.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA 0.33 Release Candidate and License Change]]></title>
        <id>https://excel-dna.github.io/blog/2015/08/03/excel-dna-0-33-release-candidate-and-license-change</id>
        <link href="https://excel-dna.github.io/blog/2015/08/03/excel-dna-0-33-release-candidate-and-license-change"/>
        <updated>2015-08-03T00:50:00.000Z</updated>
        <summary type="html"><![CDATA[Version 0.33 Release Candidate]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="version-033-release-candidate">Version 0.33 Release Candidate<a href="#version-033-release-candidate" class="hash-link" aria-label="Direct link to Version 0.33 Release Candidate" title="Direct link to Version 0.33 Release Candidate">​</a></h2><p>Excel-DNA 0.33 contains a number of bug fixes and improvements, including a <a href="https://github.com/Excel-DNA/ExcelDna/wiki/Diagnostic-Logging" target="_blank" rel="noopener noreferrer">diagnostic logging</a> approach based on the .NET Trace classes. More details can be found in the current <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/Distribution/ChangeLog.txt" target="_blank" rel="noopener noreferrer">ChangeLog</a>.</p><p>This version will also be the foundation for a first release of the custom Registration extension and the ongoing work towards on-sheet IntelliSense for user-defined functions.</p><p>A release candidate for the new version is available</p><ul><li>as a <a href="https://github.com/Excel-DNA/ExcelDna/releases/tag/v0.33.7-rc1" target="_blank" rel="noopener noreferrer">GitHub release</a>;</li><li>as a <a href="https://exceldna.codeplex.com/releases/view/616591" target="_blank" rel="noopener noreferrer">CodePlex download</a>;</li><li>and in the (pre-release) <a href="https://www.nuget.org/packages/ExcelDna.AddIn/" target="_blank" rel="noopener noreferrer">ExcelDna.AddIn NuGet package</a>.</li></ul><p>Please help me test that the new version works correctly in the many different ways, Excel and Windows versions, and languages where Excel-DNA add-ins run.</p><p>If you run into any unexpected behavior bugs or regressions, please post to the <a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">Google group</a> or contact me directly.</p><p>Also, if you are able to confirm that the new version works in a particular setting, please post that too. Details about what functionality you've tested and what operating environment (including .NET and Excel version) you are running with, would help me a lot.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="license-change">License Change<a href="#license-change" class="hash-link" aria-label="Direct link to License Change" title="Direct link to License Change">​</a></h2><p><del>For the Excel-DNA project, I've changed to the standard <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/LICENSE.txt" target="_blank" rel="noopener noreferrer">MIT license</a>. This has become the most common open-source license aligned with my intention of making Excel-DNA free for all use, including commercial use</del>. <strong>UPDATE 2015-09-03</strong>: Excel-DNA is (again) licensed under the <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/LICENSE.txt" target="_blank" rel="noopener noreferrer">zlib license</a>. More details <a href="/2015/09/03/excel-dna-version-0-33-8-rc2-available/">here</a>.</p><p>If you have any concerns with this change, please let me know.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nuget-packages">NuGet Packages<a href="#nuget-packages" class="hash-link" aria-label="Direct link to NuGet Packages" title="Direct link to NuGet Packages">​</a></h2><p>With this version, I am re-aligning the Excel-DNA package names on NuGet with the assembly names and standard naming conventions. The main packages for this release will be:</p><ul><li><p><strong><a href="https://www.nuget.org/packages/ExcelDna.AddIn/" target="_blank" rel="noopener noreferrer">ExcelDna.AddIn</a></strong> - Includes the <code>.xll</code> and creates a complete add-in when installed into a Class Library project. This is update of the "Excel-DNA" package.</p></li><li><p><strong><a href="https://www.nuget.org/packages/ExcelDna.Integration/" target="_blank" rel="noopener noreferrer">ExcelDna.Integration</a></strong> - Contains only the integration reference library, suitable for referencing in third-party libraries that are intended to be used in Excel-DNA add-ins. An update of the "Excel-DNA.Lib" package.</p></li></ul><p>The old packages will be updated to refer to the new ones as dependencies, which should allow package updates to work correctly.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github">GitHub<a href="#github" class="hash-link" aria-label="Direct link to GitHub" title="Direct link to GitHub">​</a></h2><p>The Excel-DNA project is (slowly) moving to <a href="https://github.com/Excel-DNA" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><ul><li>The core library project can be found at <a href="https://github.com/Excel-DNA/ExcelDna/" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/ExcelDna</a>, where the latest source versions are hosted.</li><li>The best documentation and links to related projects and other source is still found on the old <a href="https://exceldna.codeplex.com" target="_blank" rel="noopener noreferrer">CodePlex site</a>.</li><li>For general questions and discussion about Excel-DNA, please continue use the <a href="https://groups.google.com/forum/#!forum/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>.</li><li>Specific issues, bug reports and feature requests can be added to the <a href="https://github.com/Excel-DNA/ExcelDna/issues/" target="_blank" rel="noopener noreferrer">GitHub Issues</a> list.</li><li>For a permanent bookmark to the project, please use the Excel-DNA home page at <a href="/">http://excel-dna.net</a>.</li></ul><hr><p>Thank you for your continued support of Excel-DNA!</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA 0.32 Released]]></title>
        <id>https://excel-dna.github.io/blog/2014/05/04/excel-dna-0-32-released</id>
        <link href="https://excel-dna.github.io/blog/2014/05/04/excel-dna-0-32-released"/>
        <updated>2014-05-04T15:46:00.000Z</updated>
        <summary type="html"><![CDATA[I've posted a final release of Excel-DNA version 0.32 to CodePlex (https//www.nuget.org/packages/Excel-DNA).]]></summary>
        <content type="html"><![CDATA[<p>I've posted a final release of Excel-DNA version 0.32 to CodePlex (<a href="https://exceldna.codeplex.com/releases/view/119190" target="_blank" rel="noopener noreferrer">https://exceldna.codeplex.com/releases/view/119190</a>) and the NuGet package repository (<a href="https://www.nuget.org/packages/Excel-DNA" target="_blank" rel="noopener noreferrer">https://www.nuget.org/packages/Excel-DNA</a>).</p><p>Excel-DNA 0.32 consolidates a large number of bug fixes and improvements that have accumulated over the last year. In particular, a number of edge cases that affect Excel-DNA add-ins under Excel 2013 have been addressed.</p><p>Native asynchronous functions, available under Excel 2010 and later, are now supported. Runtime registration of delegate functions and external retrieval of registration details will allow development of extension features without requiring changes to the Excel-DNA core runtime - see the ExcelDna.CustomRegistration project for examples of the dynamic registration: <a href="https://github.com/Excel-DNA/CustomRegistration" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/CustomRegistration</a></p><p>Excel-DNA 0.32 introduces one breaking change: integer parameter conversions are modified to be consistent with VBA. Fractional values passed to functions with integer parameters are converted using the round-to-even convention - as is the case for VBA functions. This issue is discussed in more detail at <a href="/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling/">http://excel-dna.net/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling/</a></p><p>See the <a href="https://exceldna.codeplex.com/SourceControl/latest#Distribution/ChangeLog.txt" target="_blank" rel="noopener noreferrer">Distribution\ChangeLog.txt</a> file for a complete list of changes in this version.</p><p>As always, I greatly appreciate any feedback on this version, and on Excel-DNA in general. Any comments or questions are welcome on the Google group or by contacting me directly.</p><p>To ensure future development of Excel-DNA, please make a donation via PayPal or arrange for a corporate support agreement. See <a href="/support/">http://excel-dna.net/support/</a> for details.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="release" term="release"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA 0.32 - Breaking changes to integer and boolean parameter handling]]></title>
        <id>https://excel-dna.github.io/blog/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling</id>
        <link href="https://excel-dna.github.io/blog/2014/05/03/excel-dna-0-32-breaking-changes-to-integer-and-boolean-parameter-handling"/>
        <updated>2014-05-03T07:08:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA version 0.32 introduces some changes in the parameter conversions applied to integer and boolean parameters. These changes improve compatibility with VBA, and make it easier to provide a consistent implementation when the conversion needs to be explicitly implemented, as for some generated methods.]]></summary>
        <content type="html"><![CDATA[<p>Excel-DNA version 0.32 introduces some changes in the parameter conversions applied to integer and boolean parameters. These changes improve compatibility with VBA, and make it easier to provide a consistent implementation when the conversion needs to be explicitly implemented, as for some generated methods.</p><p>In Excel-DNA versions before 0.32, UDF functions taking integer and boolean parameters were registered with the C API using the respective types, and hence the conversions were performed by Excel before calling the UDF. In Excel-DNA 0.32, these conversions are performed by Excel-DNA, with the changes discussed here. Affected functions would previously have behaved consistent with <code>.xll</code> add-ins made with C/C++, where registered with integer or boolean parameter types.</p><p>The new behaviour for integer conversions is that double values passed from Excel to integer parameters in UDFs are converted using the "Round-To-Even" midpoint rounding convention. Previously, positive midpoint values (like <code>2.5</code>) were rounded up (to <code>3</code>), while negative midpoint values were rounded down (<code>-2.5</code> to <code>-3</code>), with the exception that <code>-0.5</code> was rounded to <code>0</code>. <code>Int64</code> (<code>long</code>) parameters are now also handled consistently.</p><p>One exception to the VBA compatibility guideline is that incoming boolean <code>true</code> values passed to integer parameters are converted to <code>1</code>, rather than <code>-1</code> as would be the case with VBA. For this case I consider it more important to be consistent with .NET conventions, whereby boolean <code>true</code> values are represented by <code>1</code>.</p><p>For conversions to boolean parameters, the main change is in how fractional values are converted to booleans. The new version is consistent with VBA - any non-zero value is converted to <code>true</code>.</p><p>I hope you will agree that the improved consistency is worth making these breaking changes, and that the decision will not cause any unexpected problems. As always, I appreciate any feedback, either directly or via the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>.</p><hr><p>The following snapshot gives a good summary of the changes:</p><p><img loading="lazy" alt="Param Conversion Table Changes" src="data:image/png;base64,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" width="749" height="263" class="img_ev3q"></p><p>The functions used are as follows:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dnaConvertInt32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-vb codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vb codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Function</span><span class="token plain"> VbaConvertInteger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token keyword" style="color:#00009f">As</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VbaConvertInteger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">End</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Function</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dnaConvertInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dnaConvertBoolean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-vb codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vb codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Function</span><span class="token plain"> VbaConvertBoolean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token keyword" style="color:#00009f">As</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VbaConvertBoolean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">End</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Function</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="0.32" term="0.32"/>
        <category label="conversions" term="conversions"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Tutorial: COM server support for VBA integration]]></title>
        <id>https://excel-dna.github.io/blog/2014/03/21/tutorial-com-server-support-for-vba-integration</id>
        <link href="https://excel-dna.github.io/blog/2014/03/21/tutorial-com-server-support-for-vba-integration"/>
        <updated>2014-03-21T23:16:00.000Z</updated>
        <summary type="html"><![CDATA[Functions and macros created in an Excel-DNA add-in can be called directly from Excel VBA by using Application.Run(...). However, .NET also supports creating rich object models that are exported as COM libraries, which can be Tools->Referenced in VBA. Excel-DNA has some advanced support to host COM-exported objects from Excel-DNA add-ins, giving some advantages over the regular .NET "Register for COM interop" hosting approach:]]></summary>
        <content type="html"><![CDATA[<p>Functions and macros created in an Excel-DNA add-in can be called directly from Excel VBA by using <code>Application.Run(...)</code>. However, .NET also supports creating rich object models that are exported as COM libraries, which can be Tools-&gt;Referenced in VBA. Excel-DNA has some advanced support to host COM-exported objects from Excel-DNA add-ins, giving some advantages over the regular .NET "Register for COM interop" hosting approach:</p><ul><li><p>COM objects that are created via the Excel-DNA COM server support will be active in the same AppDomain as the rest of the add-in, allowing direct shared access to static variables, internal caches etc.</p></li><li><p>COM registration for classes hosted by Excel-DNA does not require administrative access (even when registered via <code>RegSvr32.exe</code>).</p></li><li><p>Everything needed for the COM server can be packed in a single-file .xll add-in, including the type library used for IntelliSense support in VBA.</p></li></ul><p><a href="http://mikejuniperhill.blogspot.com/" target="_blank" rel="noopener noreferrer">Mikael Katajamäki</a> has written some detailed tutorial posts on his <a href="http://mikejuniperhill.blogspot.com/" target="_blank" rel="noopener noreferrer">Excel in Finance</a> blog that explore this Excel-DNA feature, with detailed explanation, step-by-step instructions, screen shots and further links. See:</p><ul><li><a href="http://mikejuniperhill.blogspot.com/2014/03/interfacing-c-and-vba-with-exceldna-no.html" target="_blank" rel="noopener noreferrer">Interfacing C# and VBA with Excel-DNA (no intellisense support)</a></li><li><a href="http://mikejuniperhill.blogspot.com/2014/03/interfacing-c-and-vba-with-exceldna_16.html" target="_blank" rel="noopener noreferrer">Interfacing C# and VBA with Excel-DNA (with intellisense support)</a></li></ul><p>Note that these techniques would work equally well with code written in VB.NET, allowing you to port VB/VBA libraries to VB.NET with Excel-DNA and then use these from VBA.</p><p>Thank you Mikael for the great write-up!</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label=".net" term=".net"/>
        <category label="com" term="com"/>
        <category label="excel" term="excel"/>
        <category label="excel-vba" term="excel-vba"/>
        <category label="exceldna" term="exceldna"/>
        <category label="vba" term="vba"/>
        <category label="xll" term="xll"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA 0.32 Release Candidate]]></title>
        <id>https://excel-dna.github.io/blog/2014/03/03/excel-dna-0-32-release-candidate</id>
        <link href="https://excel-dna.github.io/blog/2014/03/03/excel-dna-0-32-release-candidate"/>
        <updated>2014-03-03T23:16:00.000Z</updated>
        <summary type="html"><![CDATA[I have posted to CodePlex (https//www.nuget.org/packages/Excel-DNA/0.32.0-rc1) a release candidate of the next Excel-DNA version.]]></summary>
        <content type="html"><![CDATA[<p>I have posted to CodePlex (<a href="https://exceldna.codeplex.com/releases/view/119190" target="_blank" rel="noopener noreferrer">https://exceldna.codeplex.com/releases/view/119190</a>) and the NuGet package manager (<a href="https://www.nuget.org/packages/Excel-DNA/0.32.0-rc1" target="_blank" rel="noopener noreferrer">https://www.nuget.org/packages/Excel-DNA/0.32.0-rc1</a>) a release candidate of the next Excel-DNA version.</p><p>I hope to make a final release in the next few weeks, once I've had confirmation that this version works well on the various platforms and Excel versions.</p><p>Please test, and let me know of any problems or surprises you run into, or confirm what features, platforms and Excel versions work correctly.</p><p>The CodePlex download is structured as before, and for the NuGet package manager, you can upgrade to the pre-release version with:</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PM&gt; Upgrade-Package Excel-DNA -Pre</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><p><strong>Excel-DNA 0.32</strong> consolidates a large number of bug fixes and improvements that have accumulated over the last year. In particular, a number of edge cases that affect Excel-DNA add-ins under Excel 2013 have been addressed.</p><p>Native asynchronous functions, available under Excel 2010 and later, are now supported. Runtime registration of delegate functions and external retrieval of registration details will allow development of extension features without requiring changes to the Excel-DNA core runtime.</p><p>Excel-DNA 0.32 is compatible with version 0.30, and introduces no notable breaking changes. See the Distribution\ChangeLog.txt file for a complete change list.</p><p>As always, I greatly appreciate any feedback on this version, and on Excel-DNA in general. Any comments or questions are welcome on the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Google group</a> or by contacting me directly.</p><p><em>To ensure future development of Excel-DNA, please make a donation via PayPal or arrange for a corporate support agreement. See <a href="/support/">http://excel-dna.net/support/</a> for details</em>.</p><p>Thank you for your continued support,
Govert</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="exceldna" term="exceldna"/>
        <category label="nuget" term="nuget"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Getting started with F# and Excel-DNA in finance]]></title>
        <id>https://excel-dna.github.io/blog/2013/11/14/getting-started-with-f-and-excel-dna-in-finance</id>
        <link href="https://excel-dna.github.io/blog/2013/11/14/getting-started-with-f-and-excel-dna-in-finance"/>
        <updated>2013-11-14T00:20:00.000Z</updated>
        <summary type="html"><![CDATA[Bram Jochems has written a friendly "Getting Started" post, discussing how to use F# with Excel-DNA in a finance context. His add-in with various F# / Excel-DNA helper utilities, and a bunch of quantitative finance-related UDFs, including option pricing function and volatility interpolation, has been published as a project on GitHub.]]></summary>
        <content type="html"><![CDATA[<p><a href="http://bramjochems.com" target="_blank" rel="noopener noreferrer">Bram Jochems</a> has written a friendly <a href="http://bramjochems.com/blog/2013/10/example-f-exceldna/" target="_blank" rel="noopener noreferrer">"Getting Started" post</a>, discussing how to use F# with Excel-DNA in a finance context. His add-in with various F# / Excel-DNA helper utilities, and a bunch of quantitative finance-related UDFs, including option pricing function and volatility interpolation, has been published as a <a href="https://github.com/bramjochems/MyExcelLib" target="_blank" rel="noopener noreferrer">project on GitHub</a>.</p><p>It's well worth a look, whether you are using F# and keen to explore Excel-DNA, or just curious about F# and looking for some practical examples.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="examples" term="examples"/>
        <category label="excel" term="excel"/>
        <category label="rtd" term="rtd"/>
        <category label="rx" term="rx"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Streaming real-time data to Excel]]></title>
        <id>https://excel-dna.github.io/blog/2013/10/07/streaming-real-time-data-to-excel</id>
        <link href="https://excel-dna.github.io/blog/2013/10/07/streaming-real-time-data-to-excel"/>
        <updated>2013-10-07T23:13:00.000Z</updated>
        <summary type="html"><![CDATA[Gert-Jan van der Kamp has posted a very nice end-to-end example on CodeProject, showing how to create a WCF service and Excel-DNA add-in to stream real-time data into Excel.]]></summary>
        <content type="html"><![CDATA[<p>Gert-Jan van der Kamp has posted a very nice end-to-end example on <a href="http://www.codeproject.com/Articles/662009/Streaming-realtime-data-to-Excel" target="_blank" rel="noopener noreferrer">CodeProject</a>, showing how to create a WCF service and Excel-DNA add-in to stream real-time data into Excel.</p><p>The example uses to use the Reactive Extensions support in Excel-DNA v. 0.30 to push the data to an Excel UDF (using Excel's RTD mechanism behind the scenes), together with a Duplex WCF service providing the data.</p><p>There was also this <a href="https://exceldna.codeplex.com/discussions/460904" target="_blank" rel="noopener noreferrer">CodePlex discussion</a> about the Excel ThrottleInterval option, which trades off the real-time update frequency against stability of the Excel calculation.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="examples" term="examples"/>
        <category label="excel" term="excel"/>
        <category label="rtd" term="rtd"/>
        <category label="rx" term="rx"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[F# and R in Excel]]></title>
        <id>https://excel-dna.github.io/blog/2013/08/05/f-and-r-in-excel</id>
        <link href="https://excel-dna.github.io/blog/2013/08/05/f-and-r-in-excel"/>
        <updated>2013-08-05T23:38:00.000Z</updated>
        <summary type="html"><![CDATA[Natallie Baikevich has posted some very pretty examples of using F# with Excel-DNA. One function uses the R type provider to easily expose a feature from an R package as an UDF in Excel. Have a look at the write-up, and the code on GitHub.]]></summary>
        <content type="html"><![CDATA[<p>Natallie Baikevich has posted some very pretty examples of using F# with Excel-DNA. One function uses the R type provider to easily expose a feature from an R package as an UDF in Excel. Have a look at the <a href="http://luajalla.azurewebsites.net/excel-dna-three-stories/" target="_blank" rel="noopener noreferrer">write-up</a>, and the <a href="https://github.com/luajalla/everything-fun/tree/master/exceldna-sample" target="_blank" rel="noopener noreferrer">code on GitHub</a>.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="samples" term="samples"/>
        <category label="fsharp" term="fsharp"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Caching and Asynchronous Excel UDFs]]></title>
        <id>https://excel-dna.github.io/blog/2013/04/02/caching-and-asynchronous-excel-udfs</id>
        <link href="https://excel-dna.github.io/blog/2013/04/02/caching-and-asynchronous-excel-udfs"/>
        <updated>2013-04-02T23:32:00.000Z</updated>
        <summary type="html"><![CDATA[This sample shows how the result of an Excel-DNA async UDF call can be cached using the .NET 4 MemoryCache class.]]></summary>
        <content type="html"><![CDATA[<p>This sample shows how the result of an Excel-DNA async UDF call can be cached using the .NET 4 MemoryCache class.</p><p>PS: Apparently there is a bug in the memory management of the .NET MemoryCache class. See the <a href="http://stackoverflow.com/questions/6895956/memorycache-strangeness" target="_blank" rel="noopener noreferrer">StackOverflow discussion</a> and the <a href="https://connect.microsoft.com/VisualStudio/feedback/details/806334/system-runtime-caching-memorycache-do-not-respect-memory-limits#" target="_blank" rel="noopener noreferrer">Connect bug report</a>. The <a href="http://www.nuget.org/packages/SharpMemoryCache" target="_blank" rel="noopener noreferrer">SharpMemoryCache NuGet package</a> might be an alternative, though I've not tried it.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">DnaLibrary</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">CachedAsyncSample</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">RuntimeVersion</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">v4.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Language</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">C#</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Reference</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">System.Runtime.Caching</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token cdata" style="color:#999988;font-style:italic">&lt;![CDATA[</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using System.Threading;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using System.Runtime.Caching;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    using ExcelDna.Integration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    public static class dnaFunctions</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        public static object dnaCachedAsync(string input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // First check the cache, and return immediately </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // if we found something.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // (We also need a unique key to identify the cache item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            string key = "dnaCachedAsync:" + input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            ObjectCache cache = MemoryCache.Default; </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            string cachedItem = cache[key] as string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            if (cachedItem != null) </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                return cachedItem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Not in the cache - make the async call </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // to retrieve the item. (The second parameter here should identify </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // the function call, so would usually be an array of the input parameters, </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // but here we have the identifying key already.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            object asyncResult = ExcelAsyncUtil.Run("dnaCachedAsync", key, () =&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // Here we fetch the data from far away....</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // This code will run on a ThreadPool thread.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // To simulate a slow calculation or web service call,</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // Just sleep for a few seconds...</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                Thread.Sleep(5000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                // Then return the result</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                return "The calculation with input " </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                        + input + " completed at " </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                        + DateTime.Now.ToString("HH:mm:ss");</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Check the asyncResult to see if we're still busy</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            if (asyncResult.Equals(ExcelError.ExcelErrorNA))</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">                return "!!! Fetching data";</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // OK, we actually got the result this time.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Add to the cache and return</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // (keeping the cached entry valid for 1 minute)</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            // Note that the function won't recalc automatically after </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            //    the cache expires. For this we need to go the </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            //    RxExcel route with an IObservable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            cache.Add(key, asyncResult, DateTime.Now.AddMinutes(1), null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            return asyncResult;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        public static string dnaTest()</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">            return "Hello from CachedAsyncSample";</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="display:inline-block;color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">  ]]&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">DnaLibrary</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="samples" term="samples"/>
        <category label="async" term="async"/>
        <category label="csharp" term="csharp"/>
        <category label="cache" term="cache"/>
        <category label="excel" term="excel"/>
        <category label="udf" term="udf"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Async and event-streaming Excel UDFs with F#]]></title>
        <id>https://excel-dna.github.io/blog/2013/03/26/async-and-event-streaming-excel-udfs-with-f</id>
        <link href="https://excel-dna.github.io/blog/2013/03/26/async-and-event-streaming-excel-udfs-with-f"/>
        <updated>2013-03-26T08:18:00.000Z</updated>
        <summary type="html"><![CDATA[There have been a some recent posts mentioning the asynchronous and reactive programming features in F#. Since Excel-DNA 0.30 added support for creating async and IObservable-based real-time data functions, I'd like to show how these F# features can be nicely exposed to Excel via Excel-DNA.]]></summary>
        <content type="html"><![CDATA[<p>There have been a some recent posts mentioning the <a href="http://blogs.msdn.com/b/dsyme/archive/2013/03/24/asynchronous-programming-from-f-to-python.aspx" target="_blank" rel="noopener noreferrer">asynchronous</a> and <a href="http://www.infoq.com/interviews/petricek-fsharp-functional-languages" target="_blank" rel="noopener noreferrer">reactive</a> programming features in F#. Since Excel-DNA 0.30 added support for creating async and <code>IObservable</code>-based real-time data functions, I'd like to show how these F# features can be nicely exposed to Excel via Excel-DNA.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iobservable-to-excel-via-excel-dna">IObservable to Excel via Excel-DNA<a href="#iobservable-to-excel-via-excel-dna" class="hash-link" aria-label="Direct link to IObservable to Excel via Excel-DNA" title="Direct link to IObservable to Excel via Excel-DNA">​</a></h2><p>Excel-DNA 0.30 allows an add-in to expose <code>IObservable</code> sources to Excel as real-time data functions. (Actually Excel-DNA defines an interface called <code>IExcelObservable</code> that matches the semantics of `IObservable&lt;\object&gt; - this is because we still target .NET 2.0 with the core library.)</p><p>Asynchronous function can then be implemented as an <code>IObservable</code> that returns a single value before completing. Cancellation (triggered when the user removes a real-time or async formula) is supported via the standard IDisposable mechanism.</p><p>Internally, Excel-DNA implements a thread-safe RTD server and registers the <code>IObservable</code> as an RTD topic. So some aspects of the <code>IObservable</code> support are subject to Excel's RTD feature works, for example the RTD throttle interval (by default 2 seconds) will also apply to <code>IObservable</code> functions.</p><p>The following functions in the <code>ExcelDna.Integration.ExcelAsyncUtil</code> helper class are relevant:</p><ul><li><p><code>ExcelAsyncUtil.Initialize()</code> - this should be called in a macro context before any of the other features are used, typically from the <code>AutoOpen()</code> handler.</p></li><li><p><code>ExcelAsyncUtil.Observe(...)</code> - registers an IExcelObservable as a real-time data function with Excel. <code>Subsequent OnNext()</code> calls will raise updates via RTD.</p></li><li><p><code>ExcelAsyncUtil.Run(...)</code> - a helper method that runs a function asynchronously on a .NET threadpool thread.</p></li></ul><p>In addition, we'll use</p><ul><li><code>ExcelObservableSource</code> - a delegate type for functions that return an <code>IExcelObservable</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="some-links">Some links:<a href="#some-links" class="hash-link" aria-label="Direct link to Some links:" title="Direct link to Some links:">​</a></h3><ul><li><a href="http://exceldna.codeplex.com/wikipage?title=Asynchronous%20Functions" target="_blank" rel="noopener noreferrer">Async functions in C#</a> - has some sample functions in C#.</li><li><a href="http://exceldna.codeplex.com/wikipage?title=Reactive%20Extensions%20for%20Excel" target="_blank" rel="noopener noreferrer">Reactive Extensions for Excel (RxExcel)</a> - the RxExcel class is a small wrapper that bridges the <code>IExcelObservable</code> to any implementation of <code>IObservable&lt;T&gt;</code>, allowing the Rx libraries to be used in Excel.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="f-helpers-for-async-and-iobservable-based-events">F# helpers for async and IObservable-based events<a href="#f-helpers-for-async-and-iobservable-based-events" class="hash-link" aria-label="Direct link to F# helpers for async and IObservable-based events" title="Direct link to F# helpers for async and IObservable-based events">​</a></h2><p>To initialize the async support in Excel-DNA, we need some code like the following:</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> FsAsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> Microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FSharp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Control</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WebExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> ExcelDna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Integration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// This class implements the IExcelAddin which allows us to initialize the ExcelAsyncUtil support.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// It must not be a nested class (e.g. defined as a type inside a module) but a top-level class (inside a namespace)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">FsAsyncAddIn</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">IExcelAddIn</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoOpen </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Initialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoClose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Uninitialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// define a regular Excel UDF just to show that the add-in works</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">[&lt;</span><span class="token annotation class-name">ExcelFunction</span><span class="token annotation annotation-content punctuation" style="color:#393A34">(</span><span class="token annotation annotation-content">Description</span><span class="token annotation annotation-content operator" style="color:#393A34">=</span><span class="token annotation annotation-content string" style="color:#e3116c">"A test function from F#"</span><span class="token annotation annotation-content punctuation" style="color:#393A34">)</span><span class="token annotation punctuation" style="color:#393A34">&gt;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> fsaAddThem </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>F# supports an asynchronous programming model via "async computation expressions". The result of an async computation expression is a value of type <code>Async&lt;T&gt;</code>, which we need to convert to an <code>IExcelObservable</code>. We use a standard <code>CancellationTokenSource</code> hooked up to the <code>IDisposable</code> to enable cancellation.</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> FsAsyncUtil </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# Async computation to Excel-DNA </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelRunAsync functionName parameters async </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// make something like CancellationDisposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> cts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CancellationTokenSource</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> disp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IDisposable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Dispose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cancel </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Start the async computation on this thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StartWithContinuations </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">   async</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">OnNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnError ex </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Token </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// return the disposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        disp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another neat feature of F# is that events are first-class types that implement <code>IObservable</code>. This means any F# event can serve as a real-time data source in an Excel formula. To bridge the F# events to the <code>IExcelObservable</code> interface is really easy, we just have the following helper:</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# IObservable to Excel-DNA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelObserve functionName parameters observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// Subscribe to the F# observable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnNext </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> observable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample-functions">Sample functions<a href="#sample-functions" class="hash-link" aria-label="Direct link to Sample functions" title="Direct link to Sample functions">​</a></h2><p>Given the above helpers, we can now explore a few ways to implement async and real-time streaming functions. As examples:</p><p>Here is a plain synchronous function to download a url into a string:</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"!!!ERROR: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Async implementation 1</strong>: Use Excel-DNA async directly to run <code>downloadString</code> on a <code>ThreadPool</code> thread</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncRunTP1 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"downloadStringAsyncTP1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create an F# asynchronous computation for the download (this functions is not exported to Excel)</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncImpl url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token computation-expression keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// In here we could check for cancellation using </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// let! ct = Async.CancellationToken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// if ct.IsCancellationRequested then ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let!</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AsyncDownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"!!!ERROR: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Async implementation 2</strong>: This function runs the async computation synchronously on a <code>ThreadPool</code> thread because that's what <code>ExcelAsyncUtil.Run</code> does. Blocking calls will block a <code>ThreadPool</code> thread, eventually limiting the concurrency of the async calls</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncTP2 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"downloadStringAsyncTP2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RunSynchronously </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Async implementation 3</strong>: Use the helper we defined above. This runs the async computation using true F# async. Should not block <code>ThreadPool</code> threads, and allows cancellation</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsync url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelRunAsync </span><span class="token string" style="color:#e3116c">"downloadStringAsync"</span><span class="token plain"> url </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Helper that will create a timer that ticks at <code>timerInterval</code> for <code>timerDuration</code>, and is then done. Also not exported to Excel (incompatible signature). Notice that from F#, the <code>timer.Elapsed</code> event of the BCL <code>Timer</code> class implements <code>IObservable</code>, so can be used directly with the transformations in the F# <code>Observable</code> module.</p><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// setup a timer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timers</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoReset </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// return an async task for stopping it after the duration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timerStop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token computation-expression keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">do</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Sleep timerDuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Start timerStop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Make sure that the type we actually observe in the event is supported by Excel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// by converting the events to timestamps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Elapsed </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> elapsed </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Event implementation</strong>: Finally this is the Excel function that will tick away in a cell. Entered into a cell (<em>and formatted as a Time value</em>), the formula <code>=startTimer(5000, 60000)</code> will show a clock that ticks every 5 seconds for a minute.</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> startTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelObserve </span><span class="token string" style="color:#e3116c">"startTimer"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> float timerDuration</span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">createTimer timerInterval timerDuration</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="putting-everything-together-in-an-excel-add-in">Putting everything together in an Excel add-in<a href="#putting-everything-together-in-an-excel-add-in" class="hash-link" aria-label="Direct link to Putting everything together in an Excel add-in" title="Direct link to Putting everything together in an Excel add-in">​</a></h2><p>A complete <code>.dna</code> script file with the above code can be found in the <a href="https://github.com/Excel-DNA/ExcelDna" target="_blank" rel="noopener noreferrer">Excel-DNA distribution</a>, under <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/Distribution/Samples/Async/FsAsync.dna" target="_blank" rel="noopener noreferrer">Distribution\Samples\Async\FsAsync.dna</a>.</p><p>Alternatively, the following steps would build an add-in in Visual Studio:</p><ul><li>Create a new F# library in Visual Studio.</li><li>Install the Excel-DNA package from NuGet (<code>Install-Package Excel-DNA</code> from the NuGet console).</li><li>Set up the Debug path:<ol><li>Select “Start External Program” and browse to find Excel.exe, e.g. for Excel 2010 the path might be: <code>C:\Program Files (x86)\Microsoft Office\Office14\EXCEL.EXE</code>.</li><li>Enter the full path to the <code>.xll</code> file in the output as the Command line arguments, e.g. <code>C:\MyProjects\TestDnaFs\bin\Debug\TestDnaFs-addin.xll</code>.</li></ol></li><li>Place the following code in <code>Library1.fs</code>, compile and run:</li></ul><div class="language-fsharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-fsharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> FsAsync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> Microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FSharp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Control</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WebExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">open</span><span class="token plain"> ExcelDna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Integration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// This class implements the IExcelAddin which allows us to initialize the ExcelAsyncUtil support.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// It must not be a nested class (e.g. defined as a type inside a module) but a top-level class (inside a namespace)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">FsAsyncAddIn</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">IExcelAddIn</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoOpen </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Initialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoClose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Uninitialize </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// a regular Excel UDF just to show that the add-in works</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> fsaAddThem </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token class-name">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Some utility functions for connecting Excel-DNA async with F#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> FsAsyncUtil </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# Async computation to Excel-DNA </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelRunAsync functionName parameters async </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// make something like CancellationDisposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> cts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CancellationTokenSource</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> disp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IDisposable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Dispose </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cancel </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Start the async computation on this thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StartWithContinuations </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">   async</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">OnNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnError ex </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnCompleted </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                cts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Token </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// return the disposable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        disp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// A helper to pass an F# IObservable to Excel-DNA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> excelObserve functionName parameters observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obsSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">ExcelObservableSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IExcelObservable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">member</span><span class="token plain"> __</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscribe observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Subscribe to the F# observable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnNext </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> observable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Observe </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">functionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obsSource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Some test functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> TestFunctions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Plain synchronous download function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// can be called from Excel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"!!!ERROR: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Uses Excel-DNA async to run download on a ThreadPool thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncTP1 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"downloadStringAsyncTP1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> downloadString url </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Create an F# asynchronous computation for the download</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Not exported to Excel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncImpl url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token computation-expression keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// In here we could check for cancellation using </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// let! ct = Async.CancellationToken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// if ct.IsCancellationRequested then ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> uri </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> webClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let!</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> webClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AsyncDownloadString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ex </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"!!!ERROR: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// This function runs the async computation synchronously on a ThreadPool thread</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// because that's what ExcelAsyncUtil.Run does</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Blocking calls will block a ThreadPool thread, eventually limiting the concurrency of the async calls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsyncTP2 url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExcelAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Run </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"downloadStringAsyncTP2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Async</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RunSynchronously </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:&gt;</span><span class="token plain"> </span><span class="token class-name">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// This runs the async computation using true F# async</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Should not block ThreadPool threads, and allows cancellation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> downloadStringAsync url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelRunAsync </span><span class="token string" style="color:#e3116c">"downloadStringAsync"</span><span class="token plain"> url </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">downloadStringAsyncImpl url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Helper that will create a timer that ticks at timerInterval for timerDuration, then stops</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Not exported to Excel (incompatible type)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> createTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// setup a timer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timers</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Timer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AutoReset  Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> elapsed </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Excel function to start the timer - using the fact that F# events implement IObservable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> startTimer timerInterval timerDuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FsAsyncUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">excelObserve </span><span class="token string" style="color:#e3116c">"startTimer"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">float timerInterval</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> float timerDuration</span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">createTimer timerInterval timerDuration</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="support-and-feedback">Support and feedback<a href="#support-and-feedback" class="hash-link" aria-label="Direct link to Support and feedback" title="Direct link to Support and feedback">​</a></h2><p>The best place to ask any questions related to Excel-DNA is the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>. Any feedback from F# users trying out Excel-DNA or the features discussed here will be very welcome. I can also be contacted directly at <a href="mailto:govert@dnakode.com" target="_blank" rel="noopener noreferrer">govert@dnakode.com</a>.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="features" term="features"/>
        <category label="samples" term="samples"/>
        <category label="async" term="async"/>
        <category label="excel" term="excel"/>
        <category label="exceldna" term="exceldna"/>
        <category label="fsharp" term="fsharp"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA NuGet Package Updated]]></title>
        <id>https://excel-dna.github.io/blog/2012/12/20/excel-dna-nuget-package-updated</id>
        <link href="https://excel-dna.github.io/blog/2012/12/20/excel-dna-nuget-package-updated"/>
        <updated>2012-12-20T22:30:00.000Z</updated>
        <summary type="html"><![CDATA[I've updated and improved the Excel-DNA NuGet package. (NuGet is the Visual Studio package manager that makes it easy to download and install external libraries into your projects.)]]></summary>
        <content type="html"><![CDATA[<p>I've updated and improved the <a href="http://nuget.org/packages/Excel-DNA/" target="_blank" rel="noopener noreferrer">Excel-DNA NuGet package</a>. (<a href="http://nuget.org" target="_blank" rel="noopener noreferrer">NuGet</a> is the Visual Studio package manager that makes it easy to download and install external libraries into your projects.)</p><p>To turn your Class Library project into an Excel add-in, just open Tools -&gt; Library Package Manager -&gt; Package Manager Console, and enter</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PM&gt; Install-Package Excel-DNA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Excel-DNA package now has an install script that creates the required <code>.dna</code> file, and a post-build step to copy the <code>.xll</code> and run the packing tool, and even configures debugging. The package should work for C#, Visual Basic and F# Class Library projects on:</p><ul><li>Visual Studio 2010 Professional and higher</li><li>Visual Studio 2012 Professional and higher</li><li>Visual Studio 2012 Express for Windows Desktop</li></ul><p>Please post any feedback - bugs, good or bad comments - to the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="exceldna" term="exceldna"/>
        <category label="nuget" term="nuget"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA Version 0.30 Released]]></title>
        <id>https://excel-dna.github.io/blog/2012/12/13/excel-dna-version-0-30-released</id>
        <link href="https://excel-dna.github.io/blog/2012/12/13/excel-dna-version-0-30-released"/>
        <updated>2012-12-13T22:30:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA Version 0.30 has now been released on CodePlex. The download]]></summary>
        <content type="html"><![CDATA[<p>Excel-DNA Version 0.30 has now been released on CodePlex. The download
is available from <a href="http://exceldna.codeplex.com/releases/view/95861" target="_blank" rel="noopener noreferrer">http://exceldna.codeplex.com/releases/view/95861</a>.</p><p>This version implements support for RTD-based asynchronous worksheet
functions based on a thread-safe RTD base class - <code>ExcelRtdServer</code>. The
asynchronous support is designed to (optionally) integrate with
the .NET 4.0 Task-based operations, as well as the Reactive Extensions
library, allowing <code>IObservable</code>s to be exposed as "live" worksheet UDFs</p><ul><li>(thus "RxExcel"). The language-specific support for asynchronous
functions found in C# 5, Visual Basic 11 and F# 2.0 can be easily
integrated with the Excel-DNA asynchronous interfaces. Some examples
experimenting with the new async features are available in the
download.</li></ul><p>Various bug fixes have also accumulated over the last 18 months, and
are collected in this release.</p><p>As always, I greatly appreciate any feedback on this version, and on
Excel-DNA in general. Any comments or questions are welcome on the
Google group or by contacting me directly.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelist---version-030-12-december-2012">Changelist - Version 0.30 (12 December 2012)<a href="#changelist---version-030-12-december-2012" class="hash-link" aria-label="Direct link to Changelist - Version 0.30 (12 December 2012)" title="Direct link to Changelist - Version 0.30 (12 December 2012)">​</a></h2><ul><li>Fixed <code>LoadComAddIn</code> error when using a direct <code>ExcelComAddIn</code>-derived class.</li><li>Fixed (Ribbon Helper) display in ribbon tooltips.</li><li>Fixed RTD / array formula activation bug.</li><li>Fixed <code>IsMacroType=true</code> reference argument sheet error (<code>ExcelReference</code> pointed to active sheet instead of current sheet).</li><li>Fixed array marshaling pointer manipulation concern under 64-bit Excel.</li><li>Fixed check for derived attributes too - for backward compatibility with v. 0.25.</li><li>Fixed assembly multiple-loading problem for packed assemblies.</li><li>Fixed persistent COM registration (<code>Regsv32.exe</code> / <code>ComServer.DllRegisterServer</code>) to allow <code>HKCR</code> registration whenever possible (for UAC elevation issue).</li><li>Fixed Excel version check when COM / RTD Server loads before add-in is loaded - ribbon would not load.</li><li>Fixed <code>IntPtr</code> <code>StackOverflowException</code> in high-memory 32-bit processes.</li><li>Fixed custom task panes <code>UserControl</code> activation - do <code>HKCR</code> registration whenever possible (for UAC elevation issue).</li><li>Fixed <code>double[0,1]</code> array marshaling memory allocation error with potential access violation.</li><li>Allow abstract base classes in <code>ExcelRibbon</code> class hierarchy. Now loads the first concrete descendent of ExcelRibbon as the ribbon handler.</li><li>Remove Obsolete class <code>ExcelDna.Integration.Excel</code>. (Use <code>ExcelDnaUtil</code> instead.) Allows smooth <code>XlCall</code> usage.</li><li>Allow external <code>SourceItem</code> packing.</li><li>Add <code>ExcelAsyncUtil</code> for async macro calls.</li><li>Add thread-safe RTD server base class <code>ExcelRtdServer</code>.</li><li>Add async function helper as <code>ExcelAsyncUtil.Run</code>.</li><li>Add support for Reactive Extensions via RTD via <code>ExcelAsyncUtil.Observe</code> and related interfaces.</li><li>Change <code>ExcelRibbon</code> and <code>ComAddIn</code> loading to use declared <code>ProgId</code> and <code>Guid</code> if <em>both</em> attributes are present. Fixed Ribbon QAT issue.</li><li>Revisit caching of <code>Application</code> object.</li><li>Rename <code>ExcelDna.Integration.Integration</code> to <code>ExcelDna.Integration.ExcelIntegration</code>.</li><li>Implement macro shortcuts (from <code>ExcelCommand</code> attributes).</li><li>Changed re-open via File-&gt;Open to do full <code>AppDomain</code> unload and add-in reload.</li></ul>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="releases" term="releases"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Patrick O'Beirne's guide for Excel VBA to VB.NET migration]]></title>
        <id>https://excel-dna.github.io/blog/2012/05/04/patrick-obeirnes-guide-on-excel-vba-to-vb-net-migration</id>
        <link href="https://excel-dna.github.io/blog/2012/05/04/patrick-obeirnes-guide-on-excel-vba-to-vb-net-migration"/>
        <updated>2012-05-04T16:55:00.000Z</updated>
        <summary type="html"><![CDATA[Patrick O'Beirne is an Excel guru who has recently been migrating some add-ins from VBA to .NET using Excel-DNA. He has some posts on the migration, including a great list of the language and interop differences to be aware of when migrating. Worth a look...]]></summary>
        <content type="html"><![CDATA[<p><a href="http://sysmod.wordpress.com/" target="_blank" rel="noopener noreferrer">Patrick O'Beirne</a> is an Excel guru who has recently been migrating some add-ins from VBA to .NET using Excel-DNA. He has some posts on the migration, including a great <a href="http://sysmod.wordpress.com/2012/05/04/migrating-excel-vba-add-in-to-vb-net-exceldna-netoffice/" target="_blank" rel="noopener noreferrer">list of the language and interop differences</a> to be aware of when migrating. Worth a look...</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel VBA to VB.NET with Excel-DNA and NetOffice]]></title>
        <id>https://excel-dna.github.io/blog/2012/01/30/excel-vba-to-vb-net-with-excel-dna-and-netoffice</id>
        <link href="https://excel-dna.github.io/blog/2012/01/30/excel-vba-to-vb-net-with-excel-dna-and-netoffice"/>
        <updated>2012-01-30T13:29:00.000Z</updated>
        <summary type="html"><![CDATA[Excel-DNA is a great library to help ease the path from Excel VBA to VB.NET. Last year another part of the puzzle fell in place: I discovered NetOffice, a version-independent set of Office interop assemblies put together by Sebastian Lange. By referencing the NetOffice assemblies instead of the official Primary Interop Assemblies (PIA) for Office, an Excel-DNA add-in can target various Excel versions with a single add-in, and also ease distribution of the required interop assemblies, even packing them into the .xll add-in itself.]]></summary>
        <content type="html"><![CDATA[<p>Excel-DNA is a great library to help ease the path from Excel VBA to VB.NET. Last year another part of the puzzle fell in place: I discovered <a href="https://github.com/netoffice" target="_blank" rel="noopener noreferrer">NetOffice</a>, a version-independent set of Office interop assemblies put together by Sebastian Lange. By referencing the NetOffice assemblies instead of the official Primary Interop Assemblies (PIA) for Office, an Excel-DNA add-in can target various Excel versions with a single add-in, and also ease distribution of the required interop assemblies, even packing them into the <code>.xll</code> add-in itself.</p><p>To explore how Excel-DNA and NetOffice can combine to convert a VBA add-in to VB.NET, I picked a small add-in made by <a href="http://rwdvc.posterous.com" target="_blank" rel="noopener noreferrer">Robert del Vicario</a> that does a risk analysis simulation inspired by the <a href="http://www.palisade.com/risk/" target="_blank" rel="noopener noreferrer">Pallisade @RISK</a> add-in. I took <a href="http://rwdvc.posterous.com/riskgen-test" target="_blank" rel="noopener noreferrer">Robert's original RiskGen VBA add-in</a>, and created a new Excel-DNA add-in in VB.NET (I used Visual Studio, but the free <a href="http://www.icsharpcode.net/OpenSource/SD/Download/#SharpDevelop4x" target="_blank" rel="noopener noreferrer">SharpDevelop</a> IDE should work fine too). I documented the steps along the way of creating the VB.NET project, making an add-in based on Excel-DNA and using NetOffice to help port the VBA code to VB.NET. The resulting document (RiskGen Port Log.docx) outlining exactly how I ported the add-in, with the new VB.NET-based <a href="http://rwdvc.posterous.com/riskgen-in-vbnet" target="_blank" rel="noopener noreferrer">RiskGen.NET</a> is also on Robert's site.</p><p>I'm also looking for some more examples of free/open source VBA add-ins to port to Excel-DNA. The best add-ins will contain a mix of user-defined functions and macros which use the Excel object model. Please post to the Google group or mail me directly if you have any suggestions.</p><p>And as always, if you need any support porting your Excel VBA add-ins to .NET using Excel-DNA, I'm happy to help on the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA Google group</a>.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="samples" term="samples"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Excel-DNA version 0.29 - RC available]]></title>
        <id>https://excel-dna.github.io/blog/2011/05/16/excel-dna-version-0-29-rc-available</id>
        <link href="https://excel-dna.github.io/blog/2011/05/16/excel-dna-version-0-29-rc-available"/>
        <updated>2011-05-16T13:09:00.000Z</updated>
        <summary type="html"><![CDATA[I have posted a release candidate of Excel-DNA version 0.29 to the CodePlex site. The download is available at http://exceldna.codeplex.com/releases/view/66405. I will wait a week or two for some confirmation that this version works correctly before setting this release to "recommended" status and updating the NuGet package. Any results from your testing with this version would be very helpful.]]></summary>
        <content type="html"><![CDATA[<p>I have posted a release candidate of Excel-DNA version 0.29 to the CodePlex site. The download is available at <a href="http://exceldna.codeplex.com/releases/view/66405" target="_blank" rel="noopener noreferrer">http://exceldna.codeplex.com/releases/view/66405</a>. I will wait a week or two for some confirmation that this version works correctly before setting this release to "recommended" status and updating the NuGet package. Any results from your testing with this version would be very helpful.</p><p>Excel-DNA version 0.29 adds support for a number of specialized Excel features. The 64-bit version of Excel 2010 is fully supported, registration-free Custom Task Panes can be created under Excel 2007 and later, direct COM server integration can improve integration with legacy VBA code, and macros with parameters are registered. In addition, there are some features to improve the development and debugging workflow, and a few minor bugfixes. The complete change list is included below.</p><p>More information about the new features will be posted on the Excel-DNA website in the coming weeks. Any comments or questions are welcome on the Google group - <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">http://groups.google.com/group/exceldna</a> - or by contacting me directly.</p><p>As always, I greatly appreciate any feedback on this version, and on Excel-DNA in general.</p><p>-Govert</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-change-list">Complete change list<a href="#complete-change-list" class="hash-link" aria-label="Direct link to Complete change list" title="Direct link to Complete change list">​</a></h3><ul><li><strong>BREAKING CHANGE!</strong> Changed <code>SheetId</code> in the <code>ExcelReference</code> type to an <code>IntPtr</code> for 64-bit compatibility.</li><li>Changed initialization - only create sandboxed <code>AppDomain</code> under .NET 4 (or if explicitly requested with <code>CreateSandboxedAppDomain="true"</code> attribute on <code>DnaLibrary</code> tag in .dna file).</li><li>Fixed memory leak when getting <code>SheetId</code> for <code>ExcelReference</code> parameters.</li><li>Fixed Ribbon <code>RunTagMacro</code> when no Workbook open.</li><li>Added support for the 64-bit version of Excel 2010 with the .Net 4 runtime.</li><li>Added Cluster-safe function support for Excel 2010 HPC Cluster Connector - mark functions as <code>IsClusterSafe=true</code>.</li><li>Added <code>CustomTaskPane</code> support and sample.</li><li>Added COM server support for RTD servers and other <code>ComVisible</code> classes. Mark <code>ExternalLibraries</code> and Projects as <code>ComServer="true"</code> in the .dna file. Supports <code>Regsvr32</code> registration or by calling <code>ComServer.DllRegisterServer</code>. Allows direct RTD and VBA object instantiation. Includes <code>TypeLib</code> registration and packing support.</li><li>Added support for macros with parameters.</li><li>Added <code>ArrayResizer</code> sample.</li><li>Added C# 4 dynamic type sample.</li><li>Added Path attribute to <code>SourceItem</code> tag to allow external source.</li><li>Added <code>LoadFromBytes</code> attribute to <code>ExternalLibrary</code> tag to prevent locking of .dll.</li><li>Added <code>/O</code> output path option to <code>ExcelDnaPack</code>.</li><li>Added "before" option to CommandBars xml.</li><li>Added <code>Int64</code> support for parameters and return values.</li></ul>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Financial Analytics Suite (FinAnSu) - made with Excel-DNA]]></title>
        <id>https://excel-dna.github.io/blog/2011/04/28/financial-analytics-suite-finansu-made-with-excel-dna</id>
        <link href="https://excel-dna.github.io/blog/2011/04/28/financial-analytics-suite-finansu-made-with-excel-dna"/>
        <updated>2011-04-28T22:51:00.000Z</updated>
        <summary type="html"><![CDATA[I recently noticed a very nice add-in developed by Bryan McKelvey called FinAnSu. The whole add-in is generously available under the MIT open source license, and is a fantastic example of what can be built with Excel-DNA.]]></summary>
        <content type="html"><![CDATA[<p>I recently noticed a very nice add-in developed by <a href="http://www.brymck.com/" target="_blank" rel="noopener noreferrer">Bryan McKelvey</a> called <a href="http://code.google.com/p/finansu/" target="_blank" rel="noopener noreferrer">FinAnSu</a>. The whole add-in is generously available under the MIT open source license, and is a fantastic example of what can be built with Excel-DNA.</p><p><a href="http://code.google.com/p/finansu/" target="_blank" rel="noopener noreferrer">FinAnSu</a> uses a ribbon interface to make the various functions and macros easy to find. The RTD server support is used to implement asynchronous data update functions, providing a live quote feed from Bloomberg, Google or Yahoo! And then there is a bunch of useful-looking financial functions. Here's a little preview:</p><p><img loading="lazy" alt="FinAnSu Quote Animated" src="/assets/images/finansu-quote-animated-9714265f5b38fe48ebc30d8c6295aa14.gif" width="423" height="282" class="img_ev3q"></p><p>Find the project on Google code: <a href="http://code.google.com/p/finansu/" target="_blank" rel="noopener noreferrer">http://code.google.com/p/finansu/</a>, with detailed documentation on the wiki: <a href="http://code.google.com/p/finansu/wiki/Introduction" target="_blank" rel="noopener noreferrer">http://code.google.com/p/finansu/wiki/Introduction</a>.</p><p>You can browse through the <a href="http://code.google.com/p/finansu/source/browse/" target="_blank" rel="noopener noreferrer">source code</a> online, but to download a copy of the whole project you'll need a <a href="http://mercurial.selenic.com/downloads/" target="_blank" rel="noopener noreferrer">Mercurial client</a>. I just installed the one called Mercurial 1.8.2 MSI installer and ran <code>hg clone https://finansu.googlecode.com/hg/ finansu</code> from a command prompt.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Resizing Excel UDF result arrays]]></title>
        <id>https://excel-dna.github.io/blog/2011/01/30/resizing-excel-udf-result-arrays</id>
        <link href="https://excel-dna.github.io/blog/2011/01/30/resizing-excel-udf-result-arrays"/>
        <updated>2011-01-30T18:27:00.000Z</updated>
        <summary type="html"><![CDATA[Update (21 June 2017)]]></summary>
        <content type="html"><![CDATA[<p><strong>Update (21 June 2017): The most up-to-date version of the ArrayResizer utility can be found here</strong>: <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/Distribution/Samples/ArrayResizer.dna" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/ExcelDna/blob/master/Distribution/Samples/ArrayResizer.dna</a></p><p><strong>Update: To work correctly under Excel 2000/2002/2003, this sample requires at least version 0.29.0.12 of Excel-DNA</strong>.</p><p>A common question on the <a href="http://groups.google.com/group/exceldna" target="_blank" rel="noopener noreferrer">Excel-DNA group</a> is how to automatically resize the results of an array formula. The most well-know appearance of this trick is in the Bloomberg add-in.</p><p><strong>WARNING! This is a bad idea</strong>. Excel does not allow you to modify the sheet from within a user-defined function. Doing this breaks Excel's calculation model.</p><p>Anyway, here is my attempt at an Excel-DNA add-in that implements this trick. My approach is to run a macro on a separate thread that will check and if required will expand the formula to an array formula of the right size. This way nothing ugly gets done if the array size is already correct - future recalculations will not run the formula array resizer if the size is still correct.</p><p>The code below will register a function call <code>Resize</code>. You can either call <code>Resize</code> from within your function, or enter something like <code>=Resize(MyFunction(…))</code> as the cell formula. The code also registers two sample functions, <code>MakeArray</code> and <code>MakeArrayAndResize</code> to play with, each take the number of rows and columns for the size of the returned array.</p><p>To test this:</p><ol><li><a href="/">Get started with Excel-DNA</a>.</li><li>Copy the code and xml wrapper into a text file called <code>Resizer.dna</code> (the xml wrapper is at the end of this post).</li><li>Copy the <code>ExcelDna.xll</code> in the Excel-DNA distribution to <code>Resizer.xll</code> (next to the <code>Resizer.dna</code>).</li><li>File-&gt;Open the <code>Resizer.xll</code> in Excel and enter something like <code>=MakeArrayAndResize(5,3)</code> into a cell.
See how it grows.</li></ol><p>In the current version, the formula expansion is destructive, so anything in the way will be erased. One case I don't know how to deal with is when there is an array that would be partially overwritten by the expended function result. In the current version Excel will display an error that says "You cannot change part of an array.", and I replace the formula with a text version of it. I'd love to know how you think we should handle this case.</p><p>Any questions or comments (can if anyone can get it to work, or not?) can be directed to the <!-- -->[Excel-DNA Google group][excel-dna-group]<!-- --> or to me directly via e-mail. I'm pretty sure there are a few cases where it will break - please let me know if you run into any problems.</p><p>I'll try to gather the comments and suggestions for an improved implementation that might go into the next version of Excel-DNA.</p><p>Also, if you have any questions about how the implementation works, I'd be happy to write a follow up post that explains a bit more of what I'm doing. But first, let's try to get it working.</p><p>Here's the Resizer add-in code:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Generic</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Reflection</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Runtime</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">InteropServices</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Threading</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">ExcelDna</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">Integration</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ResizeTest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MakeArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token class-name punctuation" style="color:#393A34">[</span><span class="token class-name punctuation" style="color:#393A34">,</span><span class="token class-name punctuation" style="color:#393A34">]</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"({0},{1})"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MakeArrayAndResize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MakeArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Call Resize via Excel - so if the Resize add-in is not part of this code, it should still work.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlUDF</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Resize"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Resizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Queue</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name">ExcelReference</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> ResizeJobs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">Queue</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&lt;</span><span class="token constructor-invocation class-name">ExcelReference</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// This function will run in the UDF context.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Needs extra protection to allow multithreaded use.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Resize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token class-name punctuation" style="color:#393A34">[</span><span class="token class-name punctuation" style="color:#393A34">,</span><span class="token class-name punctuation" style="color:#393A34">]</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ExcelReference</span><span class="token plain"> caller </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfCaller</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token class-name">ExcelReference</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">caller </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetLength</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> columns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetLength</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RowLast </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RowFirst </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ColumnLast </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ColumnFirst </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Size problem: enqueue job, call async update and return #N/A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Add guard for ever-changing result?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">EnqueueResize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">caller</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">AsyncRunMacro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"DoResizing"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ExcelError</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExcelErrorNA</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Size is already OK - just return result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">EnqueueResize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExcelReference</span><span class="token plain"> caller</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> columns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ExcelReference</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ExcelReference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RowFirst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RowFirst </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> rows </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ColumnFirst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ColumnFirst </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> columns </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> caller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SheetId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ResizeJobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Enqueue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DoResizing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ResizeJobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Count </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">DoResize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ResizeJobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dequeue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DoResize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExcelReference</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Get the current state for reset later</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcEcho</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Get the formula in the first cell of the target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> formula </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfGetCell</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">41</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">ExcelReference</span><span class="token plain"> firstCell </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ExcelReference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RowFirst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RowFirst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ColumnFirst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ColumnFirst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SheetId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">bool</span><span class="token plain"> isFormulaArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfGetCell</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">49</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isFormulaArray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token plain"> oldSelectionOnActiveSheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfSelection</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token plain"> oldActiveCell </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfActiveCell</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Remember old selection and select the first cell of the target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> firstCellSheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlSheetNm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> firstCell</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcWorkbookSelect</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:#00009f">object</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">[</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">firstCellSheet</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token plain"> oldSelectionOnArraySheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfSelection</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcFormulaGoto</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> firstCell</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Extend the selection to the whole array and clear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcSelectSpecial</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">ExcelReference</span><span class="token plain"> oldArray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ExcelReference</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfSelection</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                oldArray</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ExcelEmpty</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcSelect</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> oldSelectionOnArraySheet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcFormulaGoto</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> oldSelectionOnActiveSheet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Get the formula and convert to R1C1 mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">bool</span><span class="token plain"> isR1C1Mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfGetWorkspace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> formulaR1C1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> formula</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">isR1C1Mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Set the formula into the whole target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                formulaR1C1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlfFormulaConvert</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> formula</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ExcelMissing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> firstCell</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Must be R1C1-style references</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token plain"> ignoredResult</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">XlCall</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">XlReturn</span><span class="token plain"> retval </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">TryExcel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcFormulaArray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> ignoredResult</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> formulaR1C1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">retval </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">XlReturn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">XlReturnSuccess</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Consider what to do now!?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Might have failed due to array in the way.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                firstCell</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"'"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> formula</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">XlCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlcEcho</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Most of this from the newsgroup: http://groups.google.com/group/exceldna/browse_thread/thread/a72c9b9f49523fc9/4577cd6840c7f195</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token class-name">TimeSpan</span><span class="token plain"> BackoffTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromSeconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AsyncRunMacro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> macroName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Do this on a new thread....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Thread</span><span class="token plain"> newThread </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">Thread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">delegate</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">RunMacro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">macroName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">COMException</span><span class="token plain"> cex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">IsRetry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BackoffTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Handle unexpected error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Exception</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Handle unexpected error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        newThread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">RunMacro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> macroName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token plain"> xlApp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">object</span><span class="token plain"> xlApp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ExcelDnaUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Application</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xlApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">InvokeMember</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Run"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BindingFlags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">InvokeMethod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xlApp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:#00009f">object</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">[</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">macroName</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TargetInvocationException</span><span class="token plain"> tie</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> tie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">InnerException</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Marshal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ReleaseComObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xlApp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">uint</span><span class="token plain"> RPC_E_SERVERCALL_RETRYLATER </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x8001010A</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">uint</span><span class="token plain"> VBA_E_IGNORE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x800AC472</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IsRetry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">COMException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">uint</span><span class="token plain"> errorCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">uint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ErrorCode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">switch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">errorCode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> RPC_E_SERVERCALL_RETRYLATER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> VBA_E_IGNORE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can easily make a test add-in for this by wrapping the code into a .dna file with this around:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">DnaLibrary</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">Language</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">CS</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token cdata" style="color:#999988;font-style:italic">&lt;![CDATA[</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="display:inline-block;color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">    &lt;!--// Paste all of the above code here //--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="display:inline-block;color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token cdata" style="color:#999988;font-style:italic">]]&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">DnaLibrary</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="samples" term="samples"/>
        <category label=".net" term=".net"/>
        <category label="async" term="async"/>
        <category label="excel" term="excel"/>
        <category label="exceldna" term="exceldna"/>
        <category label="xll" term="xll"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Offloading UDF computations to a Windows HPC cluster from Excel 2010]]></title>
        <id>https://excel-dna.github.io/blog/2010/12/09/cluster-udf-support</id>
        <link href="https://excel-dna.github.io/blog/2010/12/09/cluster-udf-support"/>
        <updated>2010-12-09T21:02:00.000Z</updated>
        <summary type="html"><![CDATA[Excel 2010 introduced support for offloading UDF computations to a compute cluster. The Excel blog talks about it http http://technet.microsoft.com/en-us/library/ff877825(WS.10).aspx.]]></summary>
        <content type="html"><![CDATA[<p>Excel 2010 introduced support for offloading UDF computations to a compute cluster. The Excel blog talks about it <a href="http://blogs.msdn.com/b/excel/archive/2010/02/12/offloading-udf-s-to-a-windows-hpc-cluster.aspx" target="_blank" rel="noopener noreferrer">http://blogs.msdn.com/b/excel/archive/2010/02/12/offloading-udf-s-to-a-windows-hpc-cluster.aspx</a>, and there are some nice pictures on this TechNet article: <a href="http://technet.microsoft.com/en-us/library/ff877825(WS.10).aspx" target="_blank" rel="noopener noreferrer">http://technet.microsoft.com/en-us/library/ff877825(WS.10).aspx</a>.</p><p>Excel-DNA now supports marking functions as cluster-safe, and I have updated the loader to allow add-ins to work under the <code>XllContainer</code> on the HPC nodes. There are some issues to be aware of:</p><ul><li>The add-in does not create its own <code>AppDomain</code> when running on the compute node. One consequence is that no custom <code>.xll.config</code> file is used; configuration entries need to be set in the <code>XllContainer</code> configuration setup.</li><li>There are some limitations on the size of array data that can be passed to and from UDF calls - this limit is probably configurable in the WCF service.</li><li>Only the 32-bit host is currently supported.</li></ul><p>To test this you will need an Windows HPC Server 2008 R2 cluster with the HPC Services for Excel installed. On the clients you need Excel 2010 with the HPC cluster connector installed. The latest check-in for Excel-DNA with this support is on GitHub: <a href="https://github.com/Excel-DNA/ExcelDna" target="_blank" rel="noopener noreferrer">https://github.com/Excel-DNA/ExcelDna</a>.</p><p>In the Microsoft HPC SDK there is a sample called ClusterUDF.xll with a few test functions. I have recreated these in C# in the samples file <a href="https://github.com/Excel-DNA/ExcelDna/blob/master/Distribution/Samples/ClusterSample.dna" target="_blank" rel="noopener noreferrer">Distribution\Samples\ClusterSample.dna</a> Basically functions just need to be marked as <code>IsClusterSafe=true</code> to be pushed to the cluster for computation. For example</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">ExcelFunction</span><span class="token attribute attribute-arguments punctuation" style="color:#393A34">(</span><span class="token attribute attribute-arguments">IsClusterSafe</span><span class="token attribute attribute-arguments operator" style="color:#393A34">=</span><span class="token attribute attribute-arguments boolean" style="color:#36acaa">true</span><span class="token attribute attribute-arguments punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DnaCountPrimesC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> nFrom</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> nTo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As usual, any feedback on this feature - questions or reports on whether you use it - will be most appreciated.</p>]]></content>
        <author>
            <name>Govert van Drimmelen</name>
            <uri>https://github.com/Excel-DNA</uri>
        </author>
        <category label="features" term="features"/>
        <category label=".net" term=".net"/>
        <category label="excel" term="excel"/>
        <category label="exceldna" term="exceldna"/>
        <category label="hpc" term="hpc"/>
        <category label="xll" term="xll"/>
    </entry>
</feed>